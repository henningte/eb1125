---
title: "Underestimation of Anaerobic Decomposition Rates in *Sphagnum* Litterbag Experiments by the Holocene Peatland Model Depends on Initial Leaching Losses"
author:
  - Henning Teickner:
      email: henning.teickner@uni-muenster.de
      institute: [iloek, ifgi]
      correspondence: true
  - Edzer Pebesma:
      email: email
      institute: [ifgi]
  - Klaus-Holger Knorr:
      email: khknorr@uni-muenster.de
      institute: [iloek]   
institute:
  - iloek: ILÖK, Ecohydrology & Biogeochemistry Group, Institute of Landscape Ecology, University of Münster, 48149, Germany
  - ifgi: IfGI, Spatiotemporal Modelling Lab, Institute for Geoinformatics, University of Münster, 48149, Germany
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::pdf_document2:
      latex_engine: xelatex
      fig_caption: yes
      keep_tex: true
      toc: false
      pandoc_args:
      - --lua-filter=templates/scholarly-metadata.lua
      - --lua-filter=templates/author-info-blocks.lua
      - --lua-filter=templates/pagebreak.lua
bibliography: references.bib
link-citations: true
csl: "templates/copernicus-publications.csl" # Insert path for the bib-style
keywords: |
  Holocene Peatland Model, peatland, litterbag, decomposition, anoxic, oxic, Bayesian data analysis
header-includes:
  - \usepackage{float}
  - \usepackage[version=4]{mhchem}
  - \usepackage{booktabs}
  - \usepackage{bm}
  - \usepackage{xr} \externaldocument{hpmd-supporting-info}
  - \usepackage{lineno}
  - \linenumbers
fontsize: 12pt
---

<!--Alternative title: Test of the Holocene Peatland Model against *Sphagnum* Litterbag Experiments from Oxic to Anoxic Conditions-->

<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

<!-- With the following code you can access and display values from the yml header above. -->

Keywords: `r rmarkdown::metadata$keywords`

Highlights: `r rmarkdown::metadata$highlights`

<!-- The following code chunk defines some general settings how code chunks should behave.  -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.pos = 'H', fig.align = 'center')

# packages
library(ggplot2)
library(tibble)
library(dplyr)
library(knitr)
library(tidyr)
library(dplyr)
library(ggtext)
library(patchwork)
library(quantities)
library(units)
library(posterior)
library(kableExtra)
library(targets)
```


# Introduction

Decomposition is one of the major controls of how much carbon (C) peatlands can store. Compared to other ecosystems, northern peatlands usually have small decomposition rates because of cold temperatures, high water table levels, acidic pH value, and litter that does not decompose fast even under more conditions facilitating microbial decomposition [@vanBreemen.1995; @Rydin.2013]. These slow decomposition rates caused northern peatlands to accumulate at least 400 Gt C [@Yu.2012; @Nichols.2019] during the Holocene and changes in the controls of decomposition rates may cause them to loose considerable amounts of C to the atmosphere under climate and land use changes [@Frolking.2011; @Loisel.2017]. Peatland models are used to better understand past C accumulation and to predict future changes in peat C stocks, but because of the long time scales which have to be considered, they are difficult to test and currently are insufficiently tested.  

How to test long-term peatland models is an open problem. Past studies have compared site-adapted simulations of peat height, age, C and N stocks, macrofossil composition, and water table level predicted by peatland models against peat core data (e.g., @Frolking.2010, @Tuittila.2013, @Treat.2021, @Zhao.2022), and have shown that  existing peatland models can reproduce observed patterns to some extent.

These tests suffer from two problems. First, they test entire peatland models against observed data and thus can identify the parameter values or model equations that cause observed discrepancies less reliably. Second, there often are large uncertainties on both sides of the test; peatland models have large uncertainties in parameter values and model structure and these may produce a range of predictions as illustrated by uncertainty analyses (e.g. @Quillet.2013, @Quillet.2013a) and model intercomparisons (e.g. @Zhao.2022). Observed data also has uncertainty from measurements, peat dating, or simply missing data, for example for past precipitation. Large uncertainties can make tests inconclusive, no matter how much data we use. An alternative which avoids some of these problems is to perform local tests which take into account relevant uncertainty sources.

A local test is a test of only a small part of a peatland model, such as the decomposition module. For example, in the Holocene Peatland Model (HPM) [@Frolking.2010], we only need to know litter species, peat water content, peat porosity, water table depth, and only five parameters to predict decomposition rates. The predictions can be compared to decomposition rates estimated from litterbag data and therefore future litterbag studies can directly test whether discrepancies are replicable and identify the factors causing the discrepancies. Admittedly, such a test is restricted to short time ranges and not representative for long-term decomposition rates, but future tests with different scope will benefit from the reduced parameter uncertainties and can consider where the model fails already on short time scales.

A local test of decomposition modules is relevant because of the importance of decomposition for long-term C accumulation in peatlands. Previous sensitivity analyses of the HPM and applications to peat cores suggest that the anoxia scale length ($c_2$), the parameter controlling how anaerobic decomposition rates are limited by electron acceptor depletion and accumulation of decomposition products, can result in a doubling of accumulated C, depending on climate conditions [@Quillet.2013a; @Kurnianto.2015].<!-- Similarly, the parameter which controls how decreasing litter quality slows down decomposition over time ($\alpha$) is an important control of long-term C accumulation (e.g., @Frolking.2001), but previous studies suggest that available litterbag or peat core data do not allow to reliably estimate it [@Clymo.1998; @Teickner.2024].--> A local test of the HPM decomposition module can provide better estimates for $c_2$<!-- and could  help to design litterbag experiments powerful enough to test plausible ranges of $\alpha$--> and may therefore help to reduce uncertainties in predicted C accumulation rates.

Currently, litterbag experiments are not as extensively used for testing peatland models as they could and only a fraction of the information available from litterbag experiments is used to develop models. The HPM uses litterbag data to define average decomposition rates of moss plant functional types, but parameters for environmental controls of decomposition are assumptions which appear to be informed at most qualitatively by litterbag experiments, and it is not tested whether the HPM successfully fits available litterbag data [@Frolking.2010]. This is also the case for other dynamic peatland models, e.g. @Frolking.2001, @Bauer.2004, @Heijmans.2008, @Heinemeyer.2010, @Morris.2012, @Chaudhary.2018, @Bona.2020.

One reason why such tests have been difficult is that suitable litterbag raw data to test peatland models are scarce. @Bona.2018 developed the Peatland Decomposition Database, but it contains only data from studies older than 2010 and no error estimates for remaining masses in litterbag data. Since decomposition rates have been estimated with different litterbag decomposition models in previous studies, their values are not directly comparable and therefore raw data are necessary to obtain estimates directly comparable to predictions from a certain peatland model [@Yu.2001; @Teickner.2024]. Recently, we used available *Sphagnum* litterbag data to estimate decomposition rates which can be directly compared to decomposition rates predicted by the HPM [@Teickner.2024].

Even though local tests are less uncertain than global tests, there still is a risk that they are dominated by uncertainties. Remaining masses in litterbag experiments are often very variable, even under controlled environmental conditions (e.g. @Bengtsson.2018), and for many litterbag experiments, a range of decomposition rates may produce similar predictions for remaining masses if a litterbag decomposition model compatible with the HPM is used [@Teickner.2024]. Finally, also only five model parameters, as in the case of the HPM decomposition module, can make predictions uncertain. These uncertainties have to be taken into account to check whether litterbag data are compatible with the peatland model. A possible way to do this is to combine the HPM decomposition module, the litterbag decomposition model from our previous study, and available litterbag experiments into one model and use Bayesian data analysis [@Gelman.2014] to estimate uncertainties of data and parameters.

If such a local test suggests that decomposition rates predicted by the HPM do not fit estimates from litterbag experiments even if main uncertainty sources are considered, we have identified a discrepancy worth considering in more detail. We can then identify how the estimated parameter values differ from the standard values and analyze whether previous sensitivity analyses of the HPM suggest that these discrepancies may have larger effects on the predicted C accumulation.<!--, use uncertainty analysis to understand how the estimated parameter estimates improve the fit to litterbag data and what might cause this, and design litterbag experiments specifically to test whether the observed discrepancies are reproducible.-->

<!--Our previous study suggests that a local test of the HPM with available litterbag data does not allow to test whether the rate at which decomposition rates are assumed to decrease with increasing mass loss, $\alpha$, equals 2, as assumed in the HPM [@Frolking.2001; @Frolking.2010] because $\alpha$ cannot be reliably estimated from available litterbag data [@Teickner.2024]. We therefore do not attempt to test $\alpha$, but since $\alpha$ is an important control of long-term C accumulation [@Frolking.2001], one may still wonder whether it is possible to estimate $\alpha$ from a litterbag experiment specifically designed for this purporse. Our Bayesian model allows to address this question because we can predict remaining masses of possible future litterbag experiments with different assumed values of $\alpha$ and analyze if this would cause differences in remaining masses which can be reliably detected.-->

Our aim is to test the HPM decmposition module against decomposition rates estimated from available *Sphagnum* litterbag experiments. Specifically, we want to: <!--In addition, we test whether one could design a litterbag experiment to estimate $\alpha$ reliable enough to test whether the value assumed by the HPM is most likely correct. Specific aims are to:-->

1. Test whether the HPM can predict litterbag decomposition rates for different *Sphagnum* species along the gradient from oxic to anoxic conditions.

2. Test whether HPM parameters estimated from litterbag data are compatible with the values originally proposed in the HPM (standard parameter values) (Tab. \@ref(tab:hpmd-m-tab-hpm-parameters-standard-values)).

<!--3. Design litterbag experiments to test whether identified discrepancies are reproducible and to test whether $\alpha$ differs from the value assumed in the HPM. -->

We test the following hypotheses:

1. The HPM can successfully predict decomposition rates estimated from litterbag data under oxic and anoxic conditions.

2. HPM parameter values ($k_{i,0}$, $W_{opt}$, $c_1$, $f_{min}$, $c_2$) estimated from litterbag experiments are compatible with the standard values.

<!--Bayesian data analysis fulfills two purposes in our study: First, if we test the HPM by comparing the decomposition rates it predicts against decomposition rates estimated from litterbag data, there are many ways in which both the HPM and our litterbag models are wrong, as outlined above. We are interested to see if the HPM cannot fit some of the available litterbag data even if we consider all the uncertainties in the data and model parameters. If we find such discrepancies, we have identified aspects of the HPM or of the litterbag experiments which need to be explained and improved. Bayesian data analysis allows to consider these uncertainties in a consistent way.

Second, since Bayesian data analysis computes a posterior distribution compatible with available data and our model, we can use uncertainty analysis methods [@Eriksson.2019] to study what effects it would have on *Sphagnum* decomposition rates estimated from litterbag data to measure remaining masses or initial leaching losses more accurately, in a world where our model is true. Bayesian data analysis therefore allows us to develop strategies to improve the accuracy of litterbag experiments in the real world from uncertainties implied by our models.-->

<!--Our test of the HPM complements previous global uncertainty analyses [@Quillet.2013a; @Quillet.2013]. As outlines above, these global analyses suggested that changes in the value of one parameter of the decomposition module, the anoxic scale length ($c_2$ in @Frolking.2010), are particularly important for C accumulation in the HPM. We quantify which values of this parameter are compatible with actually measured data. Both uncertainty analyses combined thus provide information on the uncertainties and potential bias of C accumulation under the HPM. [---todo: check: can I give a number here?]-->

To address these aims, we developed a model that combines the HPM decomposition module and our previous *Sphagnum* litterbag decomposition model, which estimates decomposition rates in available litterbag experiments while considering initial leaching losses <!--model 1-4 in -->[@Teickner.2024]. Estimated decomposition rates of this model can be directly compared to decomposition rates predicted by the HPM because the formula to compute remaining masses from decomposition rates is the same. 

We only test the decomposition module of the HPM, but our results are valuable also for other peatland models that parameterize their decomposition modules from litterbag experiments because they also require a correct representation of how decomposition rates are controlled by the water table level. Our test identified discrepancies between the HPM and litterbag data that could give novel insights into processes controlling anaerobic decomposition rates in future litterbag experiments.   
(ref:hpmd-m-tab-hpm-parameters-standard-values-caption) Standard values of parameters of the decomposition module in the Holocene Peatland Model [@Frolking.2010].

```{r hpmd-m-tab-hpm-parameters-standard-values, tab.cap='(ref:hpmd-m-tab-hpm-parameters-standard-values-caption)'}
hpmd_get_hpm_standard_parameter_values() |>
  dplyr::mutate(
    variable_pretty =
      dplyr::case_when(
        variable == "m69_p1" ~ "$W_{opt}$ (L$_\\mathrm{water}$ L$_\\mathrm{pores}^{-1}$)",
        variable == "m69_p2" ~ "$c_1$ (-)",
        variable == "m68_p1" ~ "$f_{min}$ (yr$^{-1}$)",
        variable == "m68_p2" ~ "$c_2$ (m)",
        variable == "m68_p3" ~ paste0("$k_{0, \\text{", tolower(hpm_microhabitat), "}}$ (yr$^{-1}$)")
      ),
    description =
      dplyr::case_when(
        variable == "m69_p1" ~ "Optimum degree of saturation for aerobic decomposition.",
        variable == "m69_p2" ~ "Curvature of the relation of the aerobic decomposition rate to the degree of saturation (larger values imply a steeper decrease of decomposition rates for degrees of saturation diverging from $W_{opt}$).",
        variable == "m68_p1" ~ "Minimum anaerobic decomposition rate.",
        variable == "m68_p2" ~ "Anoxia scale length. Represents limitation of anaerobic decomposition rates with increasing distance below the annual average water table depth due to end product accumulation and limitation of available electron acceptors. Larger values mean that anaerobic decomposition rates decrease less strongly with depth below the average annual water table level.",
        variable == "m68_p3" ~ paste0("Maximum possible decomposition rate for ", tolower(hpm_microhabitat), " $Sphagnum$ species.")
      )
  ) |>
  dplyr::select(variable_pretty, value, description) |>
  kableExtra::kable(
    col.names = c("HPM parameter", "Standard value", "Description"), 
    booktabs = TRUE,
    escape = FALSE
  ) %>%
  kableExtra::kable_styling(latex_options = c("hold_position", "scale_down")) |>
  kableExtra::column_spec(3, width = "12cm")
```


# Methods {#sdm-003-methods}

```{r res-import}
# model estimates
hpmd_stan_draws_1 <- readRDS_rvars(tar_read(hpmd_stan_draws_1))
hpmd_stan_draws_2 <- readRDS_rvars(tar_read(hpmd_stan_draws_2))
hpmd_stan_draws_3 <- readRDS_rvars(tar_read(hpmd_stan_draws_3))
hpmd_stan_draws_4 <- readRDS_rvars(tar_read(hpmd_stan_draws_4))
hpmd_stan_draws_5 <- readRDS_rvars(tar_read(hpmd_stan_draws_5))
hpmd_stan_draws_9 <- readRDS_rvars(tar_read(hpmd_stan_draws_9))

# model rmse
hpmd_stan_rmse_1 <- readRDS_rvars(tar_read(hpmd_stan_rmse_1))
hpmd_stan_rmse_2 <- readRDS_rvars(tar_read(hpmd_stan_rmse_2))
hpmd_stan_rmse_3 <- readRDS_rvars(tar_read(hpmd_stan_rmse_3))
hpmd_stan_rmse_4 <- readRDS_rvars(tar_read(hpmd_stan_rmse_4))
hpmd_stan_rmse_5 <- readRDS_rvars(tar_read(hpmd_stan_rmse_5))
hpmd_stan_rmse_9 <- readRDS_rvars(tar_read(hpmd_stan_rmse_9))

# for discussion
hpmd_simulation_1_newdata_1 <- readRDS_rvars(tar_read(hpmd_simulation_1_newdata_1))
hpmd_simulation_1_newdata_2 <- readRDS_rvars(tar_read(hpmd_simulation_1_newdata_2))
hpmd_simulation_1_newdata_3 <- readRDS_rvars(tar_read(hpmd_simulation_1_newdata_3))
hpmd_simulation_1_newdata_4 <- readRDS_rvars(tar_read(hpmd_simulation_1_newdata_4))

# get parameter values
hpmd_peat_properties <-
  hpmd_get_peat_properties()

hpmd_hpm_standard_parameter_values <-
  hpmd_get_hpm_standard_parameter_values()

# main data table
tar_load(hpmd_data)
```


## *Sphagnum* litterbag decomposition data {#sdm-003-methods-1}

```{r m-peatland-decomposition-database-citation}
hpmd_citations <- 
  hpmd_stan_draws_1 |>
  dplyr::filter(id_citation != "Bengtsson.2017") |>
  dplyr::select(id_citation) |>
  dplyr::mutate(
    id_citation_year =
      id_citation |>
      stringr::str_extract(pattern = "\\d+") |>
      as.integer()
  ) |>
  dplyr::arrange(id_citation_year) |>
  dplyr::pull(id_citation) |>
  unique()

hpmd_citations_index_hpm <- 
  hpmd_stan_draws_1 |>
  dplyr::filter(id_citation != "Bengtsson.2017" & index_hpm) |>
  dplyr::select(id_citation) |>
  dplyr::mutate(
    id_citation_year =
      id_citation |>
      stringr::str_extract(pattern = "\\d+") |>
      as.integer()
  ) |>
  dplyr::arrange(id_citation_year) |>
  dplyr::pull(id_citation) |>
  unique()
```


To test the HPM against litterbag data, we use the Sphagnum Decomposition Database [@Teickner.2024]. In this study, we use data from  `r paste0("@", hpmd_citations) |> knitr::combine_words()` to estimate litterbag decomposition rates and predicted $k_0$ were tested against $k_0$ estimated from `r paste0("@", hpmd_citations_index_hpm) |> knitr::combine_words()` because only these studies reported water table depths required to make predictions with the HPM. Samples originally classified as *Sphagnum magellanicum* are here classified as *Sphagnum magellanicum aggr.* [@Hassel.2018].

<!--Combining available data from heterogeneous litterbag experiments always leaves some risk that factors which are not considered in our test of the HPM differ between studies (for example mesh sizes, whether whole plants or only parts were used). The advantage is that such a test costs no additional experimental resources and future experiments can be designed specifically to test whether identified discrepancies are flukes or not.-->  


## Prediction of litterbag decomposition rates with the Holocene Peatland Model {#sdm-003-methods-2}

To predict decomposition rates, the HPM decomposition module needs as inputs the litter type in terms of the HPM plant functional types, the fraction of mass already lost due to previous decomposition, the depth of the litter below the peat surface, the water table depth, and the peat degree of saturation [@Frolking.2010].

Predicting decomposition rates for the available litterbag data is not straightforward because the HPM does not consider specific features of litterbag experiments, because it does not specify how to assign species to plant functional types, and because required variables such as the degree of saturation are not reported in the litterbag studies and therefore need to be estimated. In addition, we need to link decomposition rates estimated from litterbag data to the decomposition rates predicted by the HPM and this requires to link remaining masses in litterbag experiments to decomposition rates. 

The only variables that can be directly linked are the depth of the litter below the peat surface, water table depths (both reported in litterbag experiments). All other variables need additional assumptions that we describe in the following subsections.


### Remaining masses and decomposition rates {#sdm-003-methods-3}

In a previous study, we estimated $k_0$ for the litterbag data using the decomposition equation of the HPM (equation (7) in @Frolking.2010) and in addition considering initial leaching losses to avoid bias of $k_0$ estimates [@Teickner.2024]:

\begin{equation}
m(t) = \begin{cases}
m_0 & \mathrm{if}~t=0\\
\frac{m_0 - l_0}{(1 + (\alpha - 1) k_0 t)^{\frac{1}{\alpha - 1}}} & \mathrm{if}~t>0\\
\end{cases}
(\#eq:decomposition-solution-2-with-leaching-1)
\end{equation}

Where $m(t)$ is the remaining mass at time $t$, $m_0$ is the mass at time $t=0$ (the initial mass), $l_0$ is the initial mass loss due to leaching and respiration of soluble compounds, $k_0$ is the decomposition rate of litter with no prior decomposition, $\alpha$ controls how the decomposition rate decreases as the fraction of remaining mass decreases and is assumed to describe how decomposition rates decrease with decreasing litter quality over time [@Frolking.2001]. 


<!--There are different ways to define decomposition and estimate decomposition rates from litterbag data (e.g., @Rovira.2010, @Frolking.2010). To make sure our test is relevant, the definition of decomposition should be the same as used in the HPM, and to make sure this is the case, we estimated decomposition rates from litterbag data with the same formula the HPM uses to predict remaining masses from decomposition rates (equation (7) in @Frolking.2010), but with some modifications to account for specific characteristics of litterbag experiments. This is model 1-4 in our previous publication and detailed information can be found there [@Teickner.2024].

Decomposition rates predicted by the HPM are best understood as depolymerization rates of litter which slow down over time as mass is lost during decomposition [@Frolking.2001; @Frolking.2010]. In *Sphagnum* litterbag experiments, there often is a pool with fast turnover rate at the start due to initial leaching losses and respiration of soluble compounds [@Moore.2001; @Scheffer.2001]. The HPM does not specifically consider initial leaching losses and respiration of soluble compounds at the start, but in *Sphagnum* litterbag experiments they can bias decomposition rate estimates [@Teickner.2024] which could invalidate our test of the HPM. 

Therefore, we used the HPM formula for remaining mass during decomposition, but added initial leaching losses to test rates of decomposition of the polymeric OM against decomposition rates of the HPM (equation \@ref(eq:decomposition-solution-2-with-leaching-1), [@Teickner.2024]):  

\begin{equation}
m(t) = \begin{cases}
m_0 & \mathrm{if}~t=0\\
\frac{m_0 - l_0}{(1 + (\alpha - 1) k_0 t)^{\frac{1}{\alpha - 1}}} & \mathrm{if}~t>0\\
\end{cases}
(\#eq:decomposition-solution-2-with-leaching-1)
\end{equation}

Where $m(t)$ is the remaining mass at time $t$, $m_0$ is the mass at time $t=0$ (the initial mass), $l_0$ is the initial mass loss due to leaching and respiration of soluble compounds, $k_0$ is the decomposition rate of litter with no prior decomposition, $\alpha$ controls how the decomposition rate decreases as the fraction of remaining mass decreases and is assumed to describe how decomposition rates decrease with decreasing litter quality over time.

Equation \@ref(eq:decomposition-solution-2-with-leaching-1) can fit *Sphagnum* litterbag data where environmental conditions were approximately constant and there was no influx of mass into the bags and we used it in a previous study to estimate $l_0$, $k_0$, and $\alpha$ (model 1-4 in @Teickner.2024). We use these estimates to test whether the HPM can fit litterbag decomposition data. 

In the HPM, $\alpha=2$, but the specific value of $\alpha$ has a negligible influence on $k_0$ and $l_0$ estimated from litterbag data and cannot be reliably estimated with available data [@Teickner.2024]. We therefore use a prior centered at 2, when estimating the model, but it has to be noted that these estimates are not accurate and biased if the true $\alpha$ differs from this estimate.-->


### Assignment of *Sphagnum* species to PFT {#sdm-003-methods-4}

The HPM defines maximum possible decomposition rates ($k_{i,0}$) for three *Sphagnum* PFT (hollow, lawn, and hummock species), but not how to assign species to them. We assigned individual *Sphagnum* species to the three PFT by comparing their niche water table depths with the optimal water table depth for net primary production defined in the HPM. Specifically, we defined fixed average annual water table depth intervals for the PFT: hollow (<5 cm), lawn ($\ge5$ cm and $<15$ cm), hummock ($\ge15$ cm). Then, we used niche water table depths and standard deviations from @Johnson.2015 to assign *Sphagnum* species to these three microhabitats. Using only average values and the microhabitat water table depth thresholds resulted in unintuitive assignments, such as assigning *S. fallax* to hummocks. To avoid such obvious misclassifications, we defined rules to assign species to HPM microhabitats based on the probability a species would occur in the three niche water table depth intervals. To compute the probabilities, we assumed a normal distribution [@Johnson.2015]:

1. Species with a probability of occurrence $\ge15$% in the intervals of all three PFT were classified as lawn species.

2. In all other cases, species were assigned to the PFT for which their probability of occurrence was largest.  

Litterbag data from @Prevost.1997 are incubations of peat samples where the species is unknown. Based on descriptions in the paper, it is likely that the peat was formed by hummock species. In addition, decomposition rate estimates for these samples are small. For these reasons, we assigned these samples to the hummock PFT of the HPM.

When estimating parameters of the HPM from the litterbag data (see section \@ref(sdm-003-methods-8)<!--models 3-3 and 3-4-->), we also estimated the maximum possible decomposition rate ($k_{i,0}$). *Sphagnum* species differ in their decomposition rate and the PFT of the HPM are a simplification which may cause misfits of the HPM to litterbag data. We therefore estimated $k_{i,0}$ for individual *Sphagnum* species in models `r hpmd_model_id_to_name("3-3")` and `r hpmd_model_id_to_name("3-4")`.    


### Degree of saturation {#sdm-003-methods-5}

We estimated the degree of saturation with the modified Granberg model (ModGberg model) [@Granberg.1999; @Kettridge.2007] from total porosity, the water table depth, and the positions of the litterbags during the incubation. The total porosity was not reported in any study and therefore we  assumed an average value of `r hpmd_peat_properties$layer_total_porosity_1_average * 100`% with a standard deviation of `r hpmd_peat_properties$layer_total_porosity_1_error * 100`%, roughly based on values reported for low-density *Sphagnum* peat [@Liu.2019]. 


### Fraction of mass lost during previous decomposition {#sdm-003-methods-6}

The HPM assumes that decomposition rates decrease the more of the initial mass has already been decomposed [@Frolking.2001; @Frolking.2010]. All litterbag data we use here, except samples from @Prevost.1997, are from *Sphagnum* samples collected from the surface of peatlands and therefore can be expected to have not experienced mass loss due to decomposition at the start of the experiments. @Prevost.1997 incubated *Sphagnum* peat collected from different depths below the surface and these samples probably have already experienced some decomposition, however it is difficult to estimate how much. To avoid this problem, we estimated $k_{i,0}$ separately for samples from different depths in @Prevost.1997, implicitly assuming that these are two different PFT with different maximum possible decomposition rate.


## Testing the HPM against litterbag data {#sdm-003-methods-7}

### Model versions {#sdm-003-methods-8}

To test different aspects of the HPM and the additional assumptions we introduce, we computed several models which differ in whether HPM parameters were fixed to their standard values<!--(HPMf)--> or estimated from data<!--(HPMe)-->, whether peat properties (porosity, water content, minimum water content at the surface) are estimated from data<!--(HPM-peat)--> or not<!--(HPM)-->, whether the litterbag decomposition model and the HPM decomposition module were estimated in two separate Bayesian models<!--(HPM)--> or one combined model<!--(HPM-LE)-->, and whether the HPM decomposition module was extended to also predict $l_0$<!--(HPM-l0)--> or not (Tab. \@ref(tab:m-litterbag-synthesis-models)).

The first model (HPMf<!--model 3-1-->) does not estimate any parameters of the HPM (except for $\alpha$) and does not estimate peat properties from the litterbag data and therefore corresponds to the HPM decomposition module with standard parameter values. Values of $k_0$ are predicted independently from the litterbag decomposition model.

Each subsequent model combines the HPM decomposition module and the litterbag decomposition model into one Bayesian model. Each of these models estimates an additional set of parameters from the litterbag data relative to the previous model (Tab. \@ref(tab:m-litterbag-synthesis-models)). First, only the peat properties (HPMf-LE-peat<!--model 3-2-->) are estimated, and second all HPM parameters ($k_{i,0}$, $c_1$, $W_{opt}$, $f_{min}$, $c_2$) (HPMe-LE-peat<!--model 3-3-->). Finally, HPMe-LE-peat-l0<!--model 3-4--> extends HPMe-LE-peat by adding formulas to model how $l_0$ depends on the degree of saturation, similar to how the HPM predicts $k_0$. 

It is important to note that combining the litterbag decomposition model and the HPM decomposition module into one Bayesian model does not only estimate HPM parameters from the litterbag data, but it also adjusts the decomposition rates estimated from litterbag data to the HPM: The HPM serves as prior in the combined model and Bayesian probability theory estimates what parameter values are compatible with the data _and_ the combined model. This is exactly what we want because there is uncertainty both in the remaining masses reported in litterbag experiments and in HPM parameters. If HPM parameter estimates from the combined model are not compatible with standard values used in the original model (Tab. \@ref(tab:hpmd-m-tab-hpm-parameters-standard-values)) even if we adjust them to the HPM within the range allowed by the uncertainties, this is a discrepancy worth testing in future experiments.

HPMf-LE-peat<!--model 3-2--> tested whether the HPM can be made compatible with available litterbag data when the HPM decomposition module and the decomposition model for litterbag data are combined and when uncertain peat properties are estimated from data.

HPMe-LE-peat<!--model 3-3--> estimates what HPM parameter values are compatible with available litterbag data and therefore allows to test whether the standard parameter values are extreme relative to these estimates. Values of $k_{i,0}$ were estimated for each species separately, as described in section \@ref(sdm-003-methods-4).

HPMe-LE-peat-l0<!--model 3-4--> was computed because decomposition rates estimated from available litterbag experiments are sensitive to initial leaching losses [@Yu.2001; @Lind.2022; @Teickner.2024]. It is therefore interesting to see whether litterbag decomposition rates are adjusted differently in HPMe-LE-peat-l0<!--model 3-4--> --- when initial leaching losses are constrained --- compared to HPMe-LE-peat<!--model 3-3--> --- when initial leaching losses can be estimated more independently for each replicate. Based on previous experiments with tea bags it is reasonable to assume that there is some relation between initial leaching losses and the degree of saturation [@Lind.2022].   

To check whether outliers in the litterbag data could influence our results, we computed one additional model, HPMe-LE-peat-l0-outlier<!--model 3-5-->, with the same structure as HPMe-LE-peat-l0, but estimated without littebag experiments identified as outliers. Litterbag experiments were defined as outliers if the reported average remaining mass of any litterbag (batch) during the experiment had a posterior probability $>99$% to be different from the remaining mass predicted by the litterbag decomposition model alone. This procedure identified experiments as outliers where remaining masses increased over time, where litterbags collected at intermediate time points had unexpectedly low remaining masses, or where initial leaching losses were retarded to later time points, presumably because of freezing after the start of the experiment [@Teickner.2024]. In total, `r hpmd_stan_draws_9 |> dplyr::filter(index_hpm & is.na(hpm_k_2_rep) & ! duplicated(id_sample_incubation_start)) |> nrow()` litterbag experiments were identified as outliers. Results for HPMe-LE-peat-l0-outlier<!--model 3-5--> are shown in supporting information \@ref(sup-10) and HPM parameter estimates agree with the other models where HPM parameters were estimated.

Strictly, we do not test the decomposition module in the HPM, but the combination of the decomposition model in the HPM and the modified Granberg model, assuming that uncertainties in water table depths are negligible and that we accounted sufficiently for uncertainties in total porosity. This ambiguity has to be accepted when combining heterogeneous litterbag data where some variables have to be estimated. Litterbag experiments where the degree of saturation is measured would be needed to avoid this ambiguity.


(ref:frolking2010-indirect) [@Frolking.2010]
(ref:teickner2024-direct) @Teickner.2024

(ref:eq-decomposition-solution-1-no-leaching-1) \@ref(eq:decomposition-solution-1-no-leaching-1)
(ref:eq-decomposition-solution-1-with-leaching-1) \@ref(eq:decomposition-solution-1-with-leaching-1)
(ref:eq-decomposition-solution-2-no-leaching-1) \@ref(eq:decomposition-solution-2-no-leaching-1)
(ref:eq-decomposition-solution-2-with-leaching-1) \@ref(eq:decomposition-solution-2-with-leaching-1)

(ref:m-litterbag-synthesis-models-caption) Overview of HPM modifications computed in this study. Complete formulas for the models are shown in supporting information \@ref(sup-1).

```{r m-litterbag-synthesis-models, tab.cap="(ref:m-litterbag-synthesis-models-caption)"}
tibble::tibble(
  id_model = c("model 3-1", "model 3-2", "model 3-3", "model 3-4", "model 3-5"),
  name_model = 
    id_model |>
    stringr::str_remove(pattern = "^model ") |>
    hpmd_model_id_to_name(),
  description = c("Decomposition model from the Holocene Peatland model with default parameter values (ref:frolking2010-indirect). The model is run with peat water contents estimated with the modified Granberg model, using water table depths and litterbag depths reported from the litterbag studies, and assuming a fixed peat porosity, and minimum peat water content at the surface. Litterbag decomposition rate estimates are from the litterbag decomposition model in (ref:teickner2024-direct).", "The same as HPMf, but combined with the litterbag decomposition model into one Bayesian model. Water table depths, peat porosity, and minimum peat water content at the surface were estimated from data.", "The same as HPMf-LE-peat, but now also parameters from the HPM decomposition model ($k_{i,0}$, $W_{opt}$, $f_{min}$, $c_1$, $c_2$) are estimated from the litterbag data.", "The same as HPMe-LE-peat, but now also an average initial leaching loss at a degree of saturation of 0 L$_\\text{water}$ L$_\\text{pores}^{-1}$ for each species and, across all species, a factor by which this average leaching loss increases or decreases as the peat degree of saturation increases are estimated.", "The same as HPMe-LE-peat-l0, but computed without litterbag experiments that were identified as outliers and for which the HPM decomposition module predicts decomposition rates (see the text for details).")
) |>
  dplyr::select(-id_model) |>
  kableExtra::kable(
    col.names = c("Model", "Description"), 
    booktabs = TRUE,
    escape = FALSE
  ) %>%
  kableExtra::kable_styling(latex_options = c("hold_position", "scale_down")) |>
  kableExtra::column_spec(2, width = "12cm")
```


### Tests of model fits to decomposition rates and comparison between estimated and standard HPM parameter values {#sdm-003-methods-9}

For each model, we computed the difference of the decomposition rate predicted by the HPM and estimated from the litterbag data for each litterbag replicate and from this the average. We then computed the posterior probability that this average difference is different from zero. A small probability indicates a misfit of the model to available litterbag data. We also tested the same difference for specific species because graphical checks indicated that the decomposition rate prediction skill of the HPM depends on species. 

For HPMe-LE-peat<!--models 3-3--> and HPMe-LE-peat-l0<!--3-4-->, we computed the posterior probability that that the HPM parameter values estimated from litterbag data ($k_{i,0}$, $c_1$, $W_{opt}$, $c_2$, $f_{min}$) differ from the standard parameter values (Tab. \@ref(tab:hpmd-m-tab-hpm-parameters-standard-values)).


<!--### Test of standard HPM parameter values against parameter values estimated from litterbag data {#sdm-003-methods-10}

For HPMe-LE-peat (models 3-3) and HPMe-LE-peat-l0 (model 3-4), we computed for each HPM parameter ($k_{i,0}$, $c_1$, $W_{opt}$, $c_2$, $f_{min}$) the posterior probability that it differs from the standard parameter value (Tab. \@ref(tab:hpmd-m-tab-hpm-parameters-standard-values)). If any of these probabilities is small, say 1% or smaller, we take it as indication that the standard value is not compatible with available litterbag data. We did not test $\alpha$ because our previous study suggested that $\alpha$ cannot be reliably estimated from the same litterbag data [@Teickner.2024].-->


### Predictive accuracy of the modified Holocene Peatland Model in comparison to the original model {#sdm-003-methods-11}

To test whether HPMe-LE-peat-l0<!--(model 3-4, section \@ref(sdm-003-methods-8))--> has not only a better fit to available litterbag data, but also a better predictive accuracy for novel data than the model with standard parameter values (HPMf<!--model 3-1-->), we compared how well both can predict the one-pool decomposition rates from litterbag experiments. 

HPM parameters of HPMf<!--model 3-1--> are not estimated from data and therefore we could compute the root mean square error of prediction (RMSE$_\text{test}$) directly with $k_0$ predicted by HPMf and estimated with the litterbag decomposition model. HPM parameters of HPMe-LE-peat-l0<!--model 3-4--> are estimated from the litterbag data and we therefore used cross-validation (CV) to estimate RMSE$_\text{test}$. 

Since decomposition rates form the same species and study usually are not independent, we defined blocks which were used as CV-folds. Each fold consists of the data from one study, except those values that were measured for *Sphagnum* species for which only this study had data (we want to estimate the predictive accuracy not for new species). Data for species with data from one study only were always used for model training and not part of the testing folds. This procedure resulted in `r hpmd_data |> dplyr::filter(! duplicated(hpm_cross_validation_id_block) & ! is.na(hpm_cross_validation_id_block)) |> nrow()` folds. HPMf and HPMe-LE-peat-l0 were tested against the same data.

<!--At each iteration of the CV procedure, one of the folds was ignored when estimating HPM parameters from the remaining data, decomposition rates were predicted for the hold out data and they were used together with the one-pool exponential decomposition rates predicted by the non-HPM part of model 3-4 to compute RMSE$_\text{test}$

We compared RMSE$_\text{test}$ between HPMf and HPMe-LE-peat-l0 for those replicates that were used as test data in the CV of HPMe-LE-peat-l0 to test whether estimating parameters of the HPM from the litterbag data not only improves fit to the data, but also the accuracy of predicting decomposition rates for novel samples.--> 

In the text, RMSE$_\text{train}$ is the RMSE computed with the data a model was estimated with (for HPMf, the data the litterbag decomposition model was estimated with), and RMSE$_\text{test}$ is the RMSE computed with independent test data.








<!--
## Test of the decomposition model in the Holocene Peatland Model against litterbag data

Strictly, model 3-1 does not test the decomposition model in the HPM, but the combination of the decomposition model in the HPM and the modified Granberg model, assuming that uncertainties in water table depths are negligible, that we accounted sufficiently for uncertainties in total porosity, and that we defined $m_i$ and $m_{i,0}$ approximately correct (i.e., we tested model 3-1 and not the HPM decomposition model). 

#### Combining the HPM and one-pool exponential decomposition models {.unnumbered}

Since we observed some misfits of model 3-1, we computed two additional models (model 3-2 and model 3-3). The purpose of the first model (model 3-2) was to analyze whether the litterbag data can be made more compatible with the decomposition model in the HPM if the decomposition model in the HPM (model 3-1) and the one-pool decomposition model considering initial leaching losses and allowing the decomposition rate to decrease over time (model 1-4) are combined in the same model if we allow the model to estimate peat properties (total porosity, the water table depth, the minimum water content at the peatland surface), and a maximum decomposition rate for each species ($k_{0,i}$ in the HPM) from the data. 

Because we use Bayesian data analysis, this means that the decomposition model in the HPM can also inform decomposition rate and leaching loss estimates in the one-pool decomposition model. Thus, the model addressed the question whether some of the prediction errors we observed for model 3-1 can be explained away if we consider uncertainties in the litterbag data, peat properties we do not know, and estimate the maximum decomposition rate for each species separately instead of for each PFT ($k_{0,i}$). 

The purpose of the other model (model 3-3) was to analyze what parameter values of the decomposition model in the HPM ($c_1$, $c_2$, $W_{opt}$, $f_{min}$, $k_{0,i}$) are compatible with the synthesized litterbag data, to test whether these parameter estimates are compatible with the standard parameter values [@Frolking.2010], and to provide updated parameter values with uncertainties compatible with available data. 

To this end, model 3-3 is a modification of model 3-2 where additionally parameters of the decomposition model in the HPM ($c_1$, $c_2$, $W_{opt}$, $f_{min}$) are estimated from data. Samples from the posterior distribution of model 3-3 represent the parameter values which are compatible with the synthesized litterbag data and our model structure (including prior choices). 
-->


## Bayesian data analysis {#sdm-003-methods-13}

```{r}
tar_load(hpmd_stan_checks)
```


All models listed in Tab. \@ref(tab:m-litterbag-synthesis-models) were computed with Bayesian statistics to account for relevant uncertainty sources and include relevant prior knowledge (for example that *Sphagnum* decomposition rates are unlikely to be larger than 0.5 yr$^{-1}$). Bayesian computations were performed using Markov Chain Monte Carlo (MCMC) sampling with Stan (`r rstan::stan_version()`) [@StanDevelopmentTeam.2021a] and rstan (`r packageVersion("rstan")`) [@StanDevelopmentTeam.2021b] using the NUTS sampler [@Hoffman.2014], with four chains, `r leaching_mcmc_config$niter` total iterations per chain, and `r leaching_mcmc_config$nwarmup` warmup iterations per chain. None of the models had divergent transitions`r if(any(hpmd_stan_checks$tables$hpmd_table_mcmc_diagnostics_summary$num_divergent > 0)) "[---todo: check this]"`, the minimum bulk effective sample size was larger than 400`r if(any(hpmd_stan_checks$tables$hpmd_table_mcmc_diagnostics_summary$min_ess_bulk <= 400)) "[---todo: check this]"`, and the largest improved $\hat{R}$ was `r hpmd_stan_checks$tables$hpmd_table_mcmc_diagnostics_summary |> dplyr::pull(max_rhat_improved) |> max(na.rm = TRUE) |> round(2)`, indicating that all chains converged [@Vehtari.2021]. All models used the same priors for the same parameters and prior choices are listed and justified in supporting Tab. \@ref(tab:sup-out-d-sdm-all-models-priors-1).

We used power-scaling of the prior and likelihood distributions as implemented in the priorsense package (`r packageVersion("priorsense")`) [@Kallioinen.2024] to analyze the relative sensitivity of the posterior distribution to small perturbations of the prior and likelihood in `r hpmd_model_id_to_name("3-4")` for HPM parameters and peat properties. This is a computationally nonexpensive way to check whether the data provide information about a parameter and where prior and data may provide conflicting information [@Kallioinen.2024]. Results of this analysis and further information on the data analysis are shown in supporting information \@ref(sup-12).  


# Results

## Fit and predictive accuracy of the different versions of the Holocene Peatland Model to available litterbag data

```{r}
a <- 
  tibble::tibble(
  id_fit = 
    hpmd_d_models |>
    dplyr::filter(! (has_cross_validation | prior_only)) |>
    dplyr::pull(id_fit),
  id_model = 
    hpmd_d_models$model_name[hpmd_d_models$id_fit %in% id_fit] |>
    hpmd_model_id_to_name(),
  rmse_train_k_2 = 
    c(
      hpmd_stan_rmse_1$rmse_total[[1]], 
      hpmd_stan_rmse_2$rmse_total[[1]],
      hpmd_stan_rmse_3$rmse_total[[1]],
      hpmd_stan_rmse_4$rmse_total[[1]],
      hpmd_stan_rmse_9$rmse_total[[1]]
    ),
  rmse_test_k_2 = 
    dplyr::case_when(
      id_fit == 1 ~ hpmd_stan_rmse_1$rmse_for_cv_folds[[1]],
      id_fit == 4 ~ hpmd_stan_rmse_5$rmse_for_cv_folds[[1]],
      TRUE ~ posterior::as_rvar(NA_real_)
    ),
  n_misfits =
    list(
      hpmd_stan_draws_1, 
      hpmd_stan_draws_2,
      hpmd_stan_draws_3,
      hpmd_stan_draws_4,
      hpmd_stan_draws_9
    ) |>
    purrr::map_int(function(.x) {
      .x |>
        dplyr::filter(! duplicated(id_sample_incubation_start)) |>
        dplyr::mutate(
          is_misfit = Pr(hpm_k_2_rep > k_2) < 0.01 | Pr(hpm_k_2_rep > k_2) > 0.99
        ) |>
        dplyr::pull(is_misfit) |>
        sum(na.rm = TRUE)
    })
) |>
  dplyr::select(-id_fit) |>
  dplyr::mutate(
    dplyr::across(
      ! dplyr::all_of(c("id_model", "n_misfits")),
      function(.x) {
        res <- 
          paste0(
            mean(.x) |> round(3),
            " (", posterior::quantile2(.x, probs = 0.025) |> round(3), ", ",
            posterior::quantile2(.x, probs = 0.975) |> round(3), ")"
          )
        
        res[is.na(.x)] <- ""
        
        res
      }
    )
  )
```


The HPM decomposition module with standard parameter values (`r hpmd_model_id_to_name("3-1")`) fitted decomposition rates estimated from litterbag data to variable degrees (Tab. \@ref(tab:out-tab-sdm-all-models-rmse-1)). All other models had an improved overall fit (smaller RMSE$_\text{train}$) to the data (Tab. \@ref(tab:out-tab-sdm-all-models-rmse-1), Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p1)). Despite better fitting the data, `r hpmd_model_id_to_name("3-4")` did not predict $k_0$ better in the cross-validation than `r hpmd_model_id_to_name("3-1")`, as indicated by a large RMSE$_\text{test}$ (Tab. \@ref(tab:out-tab-sdm-all-models-rmse-1)).

Errors of `r hpmd_model_id_to_name("3-1")` differed between species (Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2)). They were particularly small for *S. fuscum* (RMSE$_\text{train}$ = `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum fuscum") |> dplyr::pull(rmse) |> mean() |> round(2)` yr$^{-1} \pm$ `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum fuscum") %>% dplyr::pull(rmse) |> sd() |> round(3)`<!--, measured rates - estimated rates = `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum fuscum") |> dplyr::pull(prediction_difference) |> mean() |> round(2)` (`r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum fuscum") |> dplyr::pull(prediction_difference) |> quantile(probs = c(0.025, 0.975)) |> round(2) |> knitr::combine_words(and = ", ")` yr$^{-1}$)-->, data from `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum fuscum") %>% dplyr::pull(list_id_citation) |> unlist() |> length()` studies) as well as *Sphagnum* spec. samples from @Prevost.1997 (RMSE$_\text{train}$ = `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum fuscum") |> dplyr::pull(rmse) |> mean() |> round(2)` yr$^{-1} \pm$ `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum") %>% dplyr::pull(rmse) |> sd() |> round(2)`<!--, measured rates - estimated rates = `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum") |> dplyr::pull(prediction_difference) |> mean() |> round(2)` (`r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum") |> dplyr::pull(prediction_difference) |> quantile(probs = c(0.025, 0.975)) |> round(2) |> knitr::combine_words(and = ", ")`) yr$^{-1}$-->). All rates were underestimated for *S. angustifolium* (RMSE$_\text{train}$ = `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum angustifolium") |> dplyr::pull(rmse) |> mean() |> round(2)` yr$^{-1} \pm$ `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum angustifolium") |> dplyr::pull(rmse) |> sd() |> round(2)`<!--, measured rates - estimated rates = `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum angustifolium") |> dplyr::pull(prediction_difference) |> mean() |> round(2)` (`r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum angustifolium") |> dplyr::pull(prediction_difference) |> quantile(probs = c(0.025, 0.975)) |> round(2) |> knitr::combine_words(and = ", ")`) yr$^{-1}$-->, data from `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum angustifolium") |> dplyr::pull(list_id_citation) |> unlist() |> length()` studies). 

<!--model 3-2 still included the HPM decomposition model with default parameters, but estimated peat properties which control peat moisture and the fraction of initial mass left at the start of the incubation ($m_i$ in the HPM [@Frolking.2010]). With these modifications, the overall RMSE$_\text{train}$ of the HPM (model 3-2) dropped to `r mean(hpmd_stan_rmse_2$rmse_total[[1]]) |> round(2)` yr$^{-1} \pm$ `r sd(hpmd_stan_rmse_2$rmse_total[[1]]) |> round(2)` (mean $\pm$ SD, n = `r sum(hpmd_stan_rmse_2$n)`) and the average difference (measured rates - estimated rates) is `r hpmd_stan_rmse_2 |> dplyr::slice(1) |> dplyr::pull(prediction_difference_total) |> mean() |> round(2)` (`r hpmd_stan_rmse_2 |> dplyr::slice(1) |> dplyr::pull(prediction_difference_total) |> quantile(probs = c(0.025, 0.975)) |> round(2) |> knitr::combine_words(and = ", ")`) yr$^{-1}$. 

model 3-3 extends model 3-2 by also estimating parameters of the HPM decomposition model, including also the maximum possible decomposition rate for each species ($k_0$), not only for the three microhabitat types in the HPM. With these modifications, the overall RMSE$_\text{train}$ of the HPM dropped to `r mean(hpmd_stan_rmse_3$rmse_total[[1]]) |> round(2)` yr$^{-1} \pm$ `r sd(hpmd_stan_rmse_3$rmse_total[[1]]) |> round(2)` (mean $\pm$ SD, n = `r sum(hpmd_stan_rmse_3$n)`) and the average difference (measured rates - estimated rates) is `r hpmd_stan_rmse_3 |> dplyr::slice(1) |> dplyr::pull(prediction_difference_total) |> mean() |> round(2)` (`r hpmd_stan_rmse_3 |> dplyr::slice(1) |> dplyr::pull(prediction_difference_total) |> quantile(probs = c(0.025, 0.975)) |> round(2) |> knitr::combine_words(and = ", ")`) yr$^{-1}$. 

Model 3-4 --- which extends model 3-3 by adding a model for the dependence of initial leaching losses on the degree of saturation --- had a similar fit to the data as the other models (RMSE$_\text{train}$ = `r mean(hpmd_stan_rmse_4$rmse_total[[1]]) |> round(2)` yr$^{-1} \pm$ `r sd(hpmd_stan_rmse_4$rmse_total[[1]]) |> round(3)` (mean $\pm$ SD, n = `r sum(hpmd_stan_rmse_4$n)`)) (Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2)).-->


(ref:out-tab-sdm-all-models-rmse-1-caption) Training and testing RMSE for decomposition rates as predicted by different versions of the Holocene Peatland Model (see Tab. \@ref(tab:m-litterbag-synthesis-models) for a description of the models) and number of misfits. RMSE$_\text{train}(k_0)$ is the root mean square error of model predictions for litterbag replicates used during model computation. RMSE$_\text{test}(k_0)$ is the RMSE for litterbag replicates used in blocked cross-validation. Where no RMSE$_\text{test}(k_0)$ is given, it was not computed for these models. Values are averages and lower and upper bounds of central 95% uncertainty intervals (yr$^{-1}$). Misfits counts the number of litterbag experiments for which $k_0$ predicted by the HPM modification differed from $k_0$ as estimated from the litterbag decomposition model with a posterior probability of at least 99%. In total, $k_0$ was predicted with the HPM modifications for `r hpmd_data |> dplyr::filter(index_hpm) |> dplyr::filter(! duplicated(id_sample_incubation_start)) |> nrow()` litterbag experiments (RMSE$_\text{train}(k_0)$) or `r hpmd_data |> dplyr::filter(index_hpm & ! is.na(hpm_cross_validation_id_block)) |> dplyr::filter(! duplicated(id_sample_incubation_start)) |> nrow()` (RMSE$_\text{test}(k_0)$).  


```{r out-tab-sdm-all-models-rmse-1, tab.cap="(ref:out-tab-sdm-all-models-rmse-1-caption)"}
a |>
  kableExtra::kable(
    col.names = c("Model", "RMSE$_\\text{train}(k_0)$", "RMSE$_\\text{test}(k_0)$", "Misfits"), 
    booktabs = TRUE,
    escape = FALSE
  ) |>
  kableExtra::kable_styling(latex_options = c("hold_position"))
```


(ref:out-p-hpm-mm27-2-mm29-1-mm30-1-p1-caption) Comparison of $k_0$ estimated by the litterbag decomposition model versus $k_0$ predicted by different modifications of the HPM decomposition module (Tab. \@ref(tab:m-litterbag-synthesis-models)). Points are colored according to the microhabitat classification of *Sphagnum species* (see the Methods section for details). Error bars exceeding 0.5 yr$^{-1}$ are clipped.


```{r out-p-hpm-mm27-2-mm29-1-mm30-1-p1, fig.cap='(ref:out-p-hpm-mm27-2-mm29-1-mm30-1-p1-caption)', out.width="100%"}
knitr::include_graphics(tar_read(hpmd_plot_1))
```


## Differences in model behavior of the Holocene Peatland Model and its modifications

#### The HPM with standard parameter values can fit litterbag data due to large uncertainties in available litterbag data. {.unnumbered}

`r hpmd_model_id_to_name("3-2")` suggests that it is possible to fit remaining masses in litterbag experiments without changing the standard HPM parameter values, simply by adjusting $k_0$ and $l_0$ estimates from the litterbag decomposition model such that they fit the HPM predictions. Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p1) shows that `r hpmd_model_id_to_name("3-2")` can reproduce these adjusted $k_0$ estimates. Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2) shows that this better fit is mainly achieved by adjusting $k_0$ estimates from the litterbag decomposition model (mainly decreased) to the HPM and not because of differences in peat properties estimated from the litterbag data. In combination with the improved fit of `r hpmd_model_id_to_name("3-2")`, this indicates that uncertainties in the litterbag data are large enough to make the HPM compatible with the litterbag decomposition rates by varying the magnitude of decomposition rates and initial leaching losses, even though the standard HPM parameters are not necessarily (most) compatible with the data. This indicates that a better test of the HPM decomposition module requires more accurate estimates of initial leaching losses.

#### Estimates for $k_0$, $l_0$, and $k_{i,0}$ differ between modifications of the HPM. {.unnumbered}

The two modifications of the HPM where HPM parameters were estimated from litterbag data (`r hpmd_model_id_to_name("3-3")`, `r hpmd_model_id_to_name("3-4")`) also differed in the magnitude of $l_0$ and $k_0$ estimates, as well as the maximum possible initial decomposition rate for each species ($k_{0,i}$). However, they had very similar estimates for the other HPM parameters ($c_1$, $W_{opt}$, $f_{min}$, $c_2$).

`r hpmd_model_id_to_name("3-3")` estimated larger initial leaching losses and smaller decomposition rates than the litterbag decomposition model from @Teickner.2024 alone, similar to `r hpmd_model_id_to_name("3-2")` (Fig. \@ref(fig:out-sdm-all-models-p2)). This is particularly the case for *S. angustifolium*, for which the separate litterbag decomposition model estimated much larger average decomposition rates and smaller initial leaching losses than the litterbag decomposition model in `r hpmd_model_id_to_name("3-3")` (Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2)). In contrast to this, initial leaching losses and smaller decomposition rates estimated by `r hpmd_model_id_to_name("3-4")` were more similar to estimates of the separate litterbag decomposition model from @Teickner.2024 (Fig. \@ref(fig:out-sdm-all-models-p2)). This indicates again that a better test of the HPM is possible when $l_0$ can be estimated more accurately.

In line with this, the maximum possible decomposition rates for the species differ between the HPM modifications. `r hpmd_model_id_to_name("3-4")` estimates a larger average maximum possible decomposition rate, particularly for *S. angustifolium*, than the other models (Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2) and supporting Fig. \@ref(fig:sup-hpmd-plot-6)).


#### Estimates for $c_1$, $W_{opt}$, $f_{min}$, $c_2$ are similar between modifications of the HPM. {.unnumbered}

In contrast to estimates for $k_0$, $l_0$, and $k_{i,0}$, the other HPM parameters had similar estimates for `r hpmd_model_id_to_name("3-3")` and `r hpmd_model_id_to_name("3-4")` and as a consequence relative differences of decomposition rates along the water table depth gradient are very similar between all models (Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2)). Estimates for $f_{min}$ did not differ much to the prior value and the power-scaling sensitivity analysis indicates a weak influence of the data (supporting information \@ref(sup-12)) and therefore that available litterbag data provide only little information about minimum decomposition rates under anoxic conditions.


#### Litterbag data do not indicate a clear relation of $l_0$ to the degree of saturation in `r hpmd_model_id_to_name("3-4")`. {.unnumbered}

```{r}
tar_load(hpmd_stan_fit_4)
tar_load(hpmd_data_stan_4)
```


`r hpmd_model_id_to_name("3-4")` suggests that both positive and negative relations of $l_0$ are compatible with available litterbag data (95% confidence intervals for the slope (logit scale): (`r hpmd_stan_fit_4 |> tidybayes::spread_rvars(hpm_l_2_p3) |> dplyr::mutate(hpm_l_2_p3 = hpm_l_2_p3 * hpmd_data_stan_4$hpm_l_2_p3_p2 + hpmd_data_stan_4$hpm_l_2_p3_p1) |> dplyr::pull(hpm_l_2_p3) |> posterior::quantile2() |> round(2) |> knitr::combine_words(and = ", ")`), supporting Fig. \@ref(fig:sup-hpmd-plot-7)). In contrast to `r hpmd_model_id_to_name("3-2")` and `r hpmd_model_id_to_name("3-3")`, it estimates on average smaller initial leaching losses, more similar to estimates of the litterbag decomposition model not combined with the HPM [@Teickner.2024] (Fig. \@ref(fig:out-sdm-all-models-p2)).


(ref:out-p-hpm-mm27-2-mm29-1-mm30-1-p2-caption) $k_0$ estimated from the litterbag data (Predicted with HPM = No) and predicted by different versions of the HPM decomposition module (Predicted with HPM = Yes) (`r hpmd_model_id_to_name("3-1")`, `r hpmd_model_id_to_name("3-2")`, `r hpmd_model_id_to_name("3-3")`, or `r hpmd_model_id_to_name("3-4")`) versus reported (`r hpmd_model_id_to_name("3-1")`) or estimated (`r hpmd_model_id_to_name("3-2")`, `r hpmd_model_id_to_name("3-3")`, or `r hpmd_model_id_to_name("3-4")`) average water table depths below the litterbags. Points represent average estimates and error bars 95% posterior intervals. Lines are predictions of linear models fitted to the average estimates. *Sphagnum* spec. are samples which have been identified only to the genus level. Only data for species with at least three replicates are shown.


```{r out-p-hpm-mm27-2-mm29-1-mm30-1-p2, fig.cap='(ref:out-p-hpm-mm27-2-mm29-1-mm30-1-p2-caption)', out.width="100%"}
knitr::include_graphics(tar_read(hpmd_plot_2))
```

(ref:out-sdm-all-models-p2-caption) Plot of $l_0$ (a) or $k_0$ (b) as predicted by litterbag decomposition models combined with different modifications of the HPM (see Tab. \@ref(tab:m-litterbag-synthesis-models)) versus estimates of the litterbag decomposition model from @Teickner.2024 for the same data. Litterbag experiments for which the HPM decomposition module could make predictions (water table depths reported in the studies) and to which the HPM parameters were fitted are shown as white points. Estimates for experiments from @Hagemann.2015 are not shown because these always had large estimates for $k_0$, were not directly tested against the HPM, and would make it difficult to represent the pattern for samples for which the HPM predicted $k_0$.

```{r out-sdm-all-models-p2, fig.cap='(ref:out-sdm-all-models-p2-caption)', out.width="100%"}
knitr::include_graphics(tar_read(hpmd_plot_3))
```


## Comparison between standard HPM parameter values defined in @Frolking.2010 and estimated from litterbag data

Figure \@ref(fig:out-mm30-hpm-test-p2) shows marginal posterior densities of the maximum possible decomposition rate for each species and the four other HPM parameters for `r hpmd_model_id_to_name("3-3")`, with standard parameter values as defined in @Frolking.2010 indicated by vertical lines. For both `r hpmd_model_id_to_name("3-3")` and `r hpmd_model_id_to_name("3-4")`, the range of parameter estimates contains the standard values, but there are large posterior probabilities that $c_2$ ($P_\text{`r hpmd_model_id_to_name("3-3")`}(c_2>`r hpmd_hpm_standard_parameter_values |> dplyr::filter(variable == "m68_p2") |> dplyr::pull(value)`~\mathrm{m}) = `r hpmd_stan_draws_3 |> dplyr::filter(index_hpm) |> dplyr::slice(1) |> dplyr::mutate(res = posterior::Pr(m68_p2 > ( hpmd_hpm_standard_parameter_values |> dplyr::filter(variable == "m68_p2") |> dplyr::pull(value)))) |> dplyr::pull(res) |> round(2)`$ and $P_\text{`r hpmd_model_id_to_name("3-4")`}(c_2>`r hpmd_hpm_standard_parameter_values |> dplyr::filter(variable == "m68_p2") |> dplyr::pull(value)`~\mathrm{m}) = `r hpmd_stan_draws_4 |> dplyr::filter(index_hpm) |> dplyr::slice(1) |> dplyr::mutate(res = posterior::Pr(m68_p2 > ( hpmd_hpm_standard_parameter_values |> dplyr::filter(variable == "m68_p2") |> dplyr::pull(value)))) |> dplyr::pull(res) |> round(2)`$) and $W_{opt}$ ($P_\text{`r hpmd_model_id_to_name("3-3")`}(W_{opt}>`r hpmd_hpm_standard_parameter_values |> dplyr::filter(variable == "m69_p1") |> dplyr::pull(value)`~\mathrm{L}_\mathrm{water}~\mathrm{L}_\mathrm{pores}^{-1}) = `r hpmd_stan_draws_3 |> dplyr::filter(index_hpm) |> dplyr::slice(1) |> dplyr::mutate(res = posterior::Pr(m69_p1 > (hpmd_hpm_standard_parameter_values |> dplyr::filter(variable == "m69_p1") |> dplyr::pull(value)))) |> dplyr::pull(res) |> round(2)`$ and $P_\text{`r hpmd_model_id_to_name("3-4")`}(W_{opt}>`r hpmd_hpm_standard_parameter_values |> dplyr::filter(variable == "m69_p1") |> dplyr::pull(value)`~\mathrm{L}_\mathrm{water}~\mathrm{L}_\mathrm{pores}^{-1}) = `r hpmd_stan_draws_4 |> dplyr::filter(index_hpm) |> dplyr::slice(1) |> dplyr::mutate(res = posterior::Pr(m69_p1 > (hpmd_hpm_standard_parameter_values |> dplyr::filter(variable == "m69_p1") |> dplyr::pull(value)))) |> dplyr::pull(res) |> round(2)`$) have larger values than the standard parameter values, indicating a discrepancy between the HPM and available litterbag data (Fig. \@ref(fig:out-mm30-hpm-test-p2) and supporting Fig. \@ref(fig:sup-hpmd-plot-4-4)).

```{r}
hpmd_stan_draws_3_k0i <-  
  hpmd_stan_draws_3 %>%
  dplyr::filter(index_hpm) %>%
  dplyr::filter(! duplicated(taxon_rank_value)) %>%
  leaching_add_taxon_rank_value_pretty() %>%
  dplyr::select(taxon_rank_value, taxon_rank_value_pretty, hpm_microhabitat, m68_p3_2) %>%
  dplyr::left_join(
    hpmd_hpm_standard_parameter_values %>%
      dplyr::filter(! is.na(hpm_microhabitat) & variable == "m68_p3") %>%
      dplyr::select(hpm_microhabitat, value) %>%
      dplyr::rename(
        k0 = "value"
      ),
    by = "hpm_microhabitat"
  )

hpmd_stan_draws_4_k0i <-  
  hpmd_stan_draws_4 %>%
  dplyr::filter(index_hpm) %>%
  dplyr::filter(! duplicated(taxon_rank_value)) %>%
  leaching_add_taxon_rank_value_pretty() %>%
  dplyr::select(taxon_rank_value, taxon_rank_value_pretty, hpm_microhabitat, m68_p3_2) %>%
  dplyr::left_join(
    hpmd_hpm_standard_parameter_values %>%
      dplyr::filter(! is.na(hpm_microhabitat) & variable == "m68_p3") %>%
      dplyr::select(hpm_microhabitat, value) %>%
      dplyr::rename(
        k0 = "value"
      ),
    by = "hpm_microhabitat"
  )
```


Both models also estimate a large posterior probability ($>95$%) that `r dplyr::intersect(hpmd_stan_draws_3_k0i |> dplyr::filter(Pr(m68_p3_2 > k0) > 0.95) |> dplyr::pull(taxon_rank_value_pretty) |> unique(), hpmd_stan_draws_4_k0i |> dplyr::filter(Pr(m68_p3_2 > k0) > 0.95) |> dplyr::pull(taxon_rank_value_pretty) |> unique()) |> knitr::combine_words()` have a larger, and that  `r dplyr::intersect(hpmd_stan_draws_3_k0i |> dplyr::filter(Pr(m68_p3_2 < k0) > 0.95) |> dplyr::pull(taxon_rank_value_pretty) |> unique(), hpmd_stan_draws_4_k0i |> dplyr::filter(Pr(m68_p3_2 < k0) > 0.95) |> dplyr::pull(taxon_rank_value_pretty) |> unique()) |> knitr::combine_words()` has a smaller maximum possible decomposition rate ($k_{0,i}$) than the standard values for the respective PFT (Fig. \@ref(fig:out-mm30-hpm-test-p2) and supporting Fig. \@ref(fig:sup-hpmd-plot-4-4)). However, because of the larger variability of $k_{0,i}$ in the cross-validation (compare with the previous subsection), this discrepancy is probably more uncertain when new data would become available.

(ref:out-mm30-hpm-test-p2-caption) Marginal posterior distributions of HPM decomposition model parameters as estimated by `r hpmd_model_id_to_name("3-3")`. (a) $k_{0,i}$ (maximum possible decomposition rate for species $i$) estimated for each species. Species were assigned to HPM microhabitats as described in section \@ref(sdm-003-methods-4). (b) other HPM parameters. Vertical black lines are the standard parameter values from @Frolking.2010. *Sphagnum* spec. are samples which have been identified only to the genus level.

```{r out-mm30-hpm-test-p2, fig.cap='(ref:out-mm30-hpm-test-p2-caption)', out.width="100%"}
knitr::include_graphics(tar_read(hpmd_plot_4_3))
```

<!--

## Compatibility of the Holocene Peatland Model with synthesized litterbag data

In its default parameterization and with the assumptions made in the methods section, the HPM decomposition model (model 3-1) was compatible with the one-pool exponential decomposition rate estimates from the model considering leaching losses (abbreviated as "measured decomposition rates" in this section) to variable degrees (Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p1)). The overall RMSE of the HPM is `r mean(hpmd_stan_rmse_1$rmse_total[[1]]) |> round(2)` yr$^{-1} \pm$ `r sd(hpmd_stan_rmse_1$rmse_total[[1]]) |> round(2)` (mean $\pm$ SD, n = `r sum(hpmd_stan_rmse_1$n)`) and the average difference (measured rates - estimated rates) is `r hpmd_stan_rmse_1 |> dplyr::slice(1) |> dplyr::pull(prediction_difference_total) |> mean() |> round(2)` (`r hpmd_stan_rmse_1 |> dplyr::slice(1) |> dplyr::pull(prediction_difference_total) |> quantile(probs = c(0.025, 0.975)) |> round(2) |> knitr::combine_words(and = ", ")`) yr$^{-1}$ (95% uncertainty interval).

Prediction errors of model 3-1 differed between species (Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2)). Prediction errors were particularly small for *S. fuscum* (RMSE = `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum fuscum") |> dplyr::pull(rmse) |> mean() |> round(2)` yr$^{-1} \pm$ `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum fuscum") %>% dplyr::pull(rmse) |> sd() |> round(2)`, measured rates - estimated rates = `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum fuscum") |> dplyr::pull(prediction_difference) |> mean() |> round(2)` (`r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum fuscum") |> dplyr::pull(prediction_difference) |> quantile(probs = c(0.025, 0.975)) |> round(2) |> knitr::combine_words(and = ", ")` yr$^{-1}$), data from `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum fuscum") %>% dplyr::pull(list_id_citation) |> unlist() |> length()` studies) as well as *Sphagnum* spec. samples from @Prevost.1997 (RMSE = `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum fuscum") |> dplyr::pull(rmse) |> mean() |> round(2)` yr$^{-1} \pm$ `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum") %>% dplyr::pull(rmse) |> sd() |> round(2)`, measured rates - estimated rates = `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum") |> dplyr::pull(prediction_difference) |> mean() |> round(2)` (`r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum") |> dplyr::pull(prediction_difference) |> quantile(probs = c(0.025, 0.975)) |> round(2) |> knitr::combine_words(and = ", ")`) yr$^{-1}$). All rates were underestimated for *S. angustifolium* (RMSE = `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum angustifolium") |> dplyr::pull(rmse) |> mean() |> round(2)` yr$^{-1} \pm$ `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum angustifolium") |> dplyr::pull(rmse) |> sd() |> round(2)`, measured rates - estimated rates = `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum angustifolium") |> dplyr::pull(prediction_difference) |> mean() |> round(2)` (`r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum angustifolium") |> dplyr::pull(prediction_difference) |> quantile(probs = c(0.025, 0.975)) |> round(2) |> knitr::combine_words(and = ", ")`) yr$^{-1}$, data from `r hpmd_stan_rmse_1 |> dplyr::filter(taxon_rank_value == "Sphagnum angustifolium") |> dplyr::pull(list_id_citation) |> unlist() |> length()` studies). 

There is indication that model 3-1 estimates a too steep response of decomposition rates to water table depth across several species if we assume that the measured decomposition rates are approximately correct. For example, the estimated decomposition rates for replicates above the water table depth are overestimated for *Sphagnum* spec., *S. balticum*, *S. cuspidatum*, and *S. fuscum* (Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2)). For other species --- *S. magellanicum aggr.* and *S. angustifolium* --- the slope of the water table response matches the data well, based on Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2). 



Incompatibility of the HPM decomposition rate estimates with the measured decomposition rates does not allow us to conclude that HPM is erroneous and that its parameters need adjustments because we have made additional assumptions which might as well be the cause of the discrepancies and because the litterbag data (remaining masses) itself are uncertain and could therefore still be compatible with the HPM with slightly different estimates for initial leaching losses and decomposition rates. We analyzed these factors with two extensions of model 3-1, models 3-2 and model 3-3 (Tab. ... [---todo:ref]). 

model 3-2 still included the HPM decomposition model with default parameters, but estimated peat properties which control peat moisture and the fraction of initial mass left at the start of the incubation ($m_i$ in the HPM [@Frolking.2010]). With these modifications, the overall RMSE of the HPM (model 3-2) dropped to `r mean(hpmd_stan_rmse_2$rmse_total[[1]]) |> round(2)` yr$^{-1} \pm$ `r sd(hpmd_stan_rmse_2$rmse_total[[1]]) |> round(2)` (mean $\pm$ SD, n = `r sum(hpmd_stan_rmse_2$n)`) and the average difference (measured rates - estimated rates) is `r hpmd_stan_rmse_2 |> dplyr::slice(1) |> dplyr::pull(prediction_difference_total) |> mean() |> round(2)` (`r hpmd_stan_rmse_2 |> dplyr::slice(1) |> dplyr::pull(prediction_difference_total) |> quantile(probs = c(0.025, 0.975)) |> round(2) |> knitr::combine_words(and = ", ")`) yr$^{-1}$. 

The decomposition rates estimated by the HPM in model 3-2 more closely fitted the measured decomposition rates for species where this was not the case for model 3-1 because the measured decomposition rates were constrained to lower values to better fit the predictions of the HPM (compare the second to the first column in Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2)). This is possible in Bayesian analysis because the HPM serves as prior which constrains decomposition rates estimated from available litterbag data within the ranges compatible with the reported measurement uncertainty and data. To achieve this while still fitting the measured remaining masses well, model 3-2 estimates slightly larger initial leaching losses (Fig. \@ref(fig:out-sdm-all-models-p2)). Thus, in a world where model 3-2 is true, lower decomposition rates are more compatible with the data, at the expense of larger initial leaching losses.

model 3-3 extends model 3-2 by also estimating parameters of the HPM decomposition model, including also the maximum possible decomposition rate for each species ($k_0$), not only for the three microhabitat types in the HPM. With these modifications, the overall RMSE of the HPM dropped to `r mean(hpmd_stan_rmse_3$rmse_total[[1]]) |> round(2)` yr$^{-1} \pm$ `r sd(hpmd_stan_rmse_3$rmse_total[[1]]) |> round(2)` (mean $\pm$ SD, n = `r sum(hpmd_stan_rmse_3$n)`) and the average difference (measured rates - estimated rates) is `r hpmd_stan_rmse_3 |> dplyr::slice(1) |> dplyr::pull(prediction_difference_total) |> mean() |> round(2)` (`r hpmd_stan_rmse_3 |> dplyr::slice(1) |> dplyr::pull(prediction_difference_total) |> quantile(probs = c(0.025, 0.975)) |> round(2) |> knitr::combine_words(and = ", ")`) yr$^{-1}$. 

As can be expected, model 3-3 even better fits measured the decomposition rates for individual species than model 3-2 because we allowed it to estimate the maximum possible decomposition rate ($k_0$) for each species (Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2)). A comparison of the estimated $k_0$ for each species to the default values for the three HPM microhabitats shows that the estimated $k_0$ differ between species, are variable within the same HPM microhabitat (and for *S. cuspidatum* not compatible with the default parameter values at a significance level of ... [---todo:add]), and have an uncertainty which is comparable to the magnitude of average inter-species differences [---todo: check] (Fig. \@ref(fig:out-mm30-hpm-test-p2) a).  

If we assume the modified Granberg model is not at fault, the reported average water table depths may be incorrect, or our assumptions about estimated peat porosities, minimum surface water content, and $m_i$ (the fraction of the initial mass remaining of the samples at the start of the litterbag experiments). To test whether reasonable alternative values to these assumptions would make HPM predictions more compatible with the data, we included the HPM decomposition model and the modified Granberg model (both with fixed parameters) into the one-pool exponential decomposition model considering initial leaching losses and estimated for each replicate an own porosity, minimum water content at the surface, average water table depth, and $m_i$ (model 3-2). Priors were the same for all replicates, except for $m_i$ for which we used a beta distribution with average ... for the *Sphagnum* spec. samples from @Prevost.1997 (since these are peat samples which probably have already experienced some decomposition) and with average ... for all other samples which may also have experienced decomposition, but less than samples from @Prevost.1997.

For discussion:  
- That the HPM underestimated larger decomposition rates is because it caps decomposition rates at a maximum of 0.13 yr$^{-1}$, whereas we have estimated for some replicates decomposition rates larger than this maximum.  
- That prediction errors differ between species indicates that either our classification of hummock and hollow *Sphagna* is not compatible with HPM or that  
- For *Sphagnum* spec., the water table depth response seems to steep. However, these are peat samples which probably have already experienced some degree of decomposition. For example, if we set $m_i = 0.5$, then the water table depth response is not too steep any more. So this discrepancy may be explained away.  
- Similarly, for most other species, samples are some part of the stem below the capitulum and therefore may also be partly decomposed. If we assume initial remaining masses of 0.9 to 0.7, this also alleviates many slope differences.  
- I should also test for effects of uncertainties in WTL.  


Some values of other HPM parameters estimated by model 3-3 were not compatible with their standard values (Fig. \@ref(fig:out-mm30-hpm-test-p2) b): Whereas standard values for $c_1$ and $f_{min}$ are compatible with estimates from model 3-3, model 3-3 suggests that $c_2$ and $W_{opt}$ should be larger. Since $W_{opt}$ is the optimum degree of saturation, model 3-3 suggests that the fastest decomposition is to be expected for degrees of saturation (`r hpmd_stan_draws_3 |> dplyr::filter(index_hpm) |> dplyr::slice(1) |> dplyr::pull(m69_p1) |> quantile(probs = c(0.025, 0.975)) |> round(2) |> knitr::combine_words(and = ", ")`) L$_\text{water}$ L$_\text{sample}^{-1}$ (95% uncertainty interval). Likewise, the anoxic scale length ($c_2$) is suggested to be within (`r hpmd_stan_draws_3 |> dplyr::filter(index_hpm) |> dplyr::slice(1) |> dplyr::pull(m68_p2) |> quantile(probs = c(0.025, 0.975)) |> round(2) |> knitr::combine_words(and = ", ")`) which means that anoxic decomposition rates should decrease less intensely with depth below the water table than suggested by the default HPM parameterization. 

Model 3-4, which extends model 3-3 by also modeling the relation between initial leaching losses and average water table depth during the incubation, had a similar fit to the measured decomposition rates as model 3-3 and also indicated similar discrepancies in HPM parameters (supporting Fig. ... [---todo:ref]sup-out-all-models-p1 and ... [---todo:ref]sup-hpmd-plot-4-4). Unlike model 3-3 (and model 3-2), the initial leaching losses and decomposition rates of model 3-4 were again more similar to the initial leaching losses and decomposition rates as estimated by model 1-2, i.e. when initial leaching losses and decomposition rates were not constrained by the HPM (Fig. \@ref(fig:out-sdm-all-models-p2)).

-->



# Discussion

Our aims were to test whether the HPM can predict litterbag decomposition rates for different *Sphagnum* species along the gradient from oxic to anoxic conditions, and to test whether HPM parameters estimated from litterbag data are compatible with the HPM standard values<!-- , and to design litterbag experiments to test these discrepancies as well as to better estimate $\alpha$ which cannot be reliably estimated from available litterbag data.-->

`r hpmd_model_id_to_name("3-2")` suggests that it is indeed possible to fit available litterbag data without changing the standard HPM parameter values because the uncertainties are large enough to support a range of parameter values. The price to be paid for this is to assume larger initial leaching losses and smaller decomposition rates than estimated with the litterbag decomposition model alone [@Teickner.2024] (Fig. \@ref(fig:out-sdm-all-models-p2)). `r hpmd_model_id_to_name("3-3")` and `r hpmd_model_id_to_name("3-4")` suggest different HPM parameter values, but Model `r hpmd_model_id_to_name("3-3")` still assumes larger initial leaching losses and smaller decomposition rates than previously estimated. In contrast, model `r hpmd_model_id_to_name("3-4")`, which assumes smaller initial leaching losses than the other models, can better reproduce decomposition rate estimates from litterbag data alone. Similarly, our previous analysis indicated that uncertain initial leaching losses also make decomposition rate estimates more uncertain [@Teickner.2024]. An important result of our study therefore is that stronger tests of the HPM decomposition module and other peatland models require litterbag experiments that allow to estimate initial leaching losses more accurately than is possible with previous experiments. 

Despite these uncertainties, our analysis of the HPM suggests that better fits to available litterbag data are possible only if several HPM parameter values are adjusted, namely the maximum possible decomposition rates for HPM PFT or *Sphagnum* species ($k_{0,i}$), the optimum degree of saturation for decomposition ($W_{opt}$), and the anoxia scale length ($c_2$). 

In the following sections, we focus on these discrepancies. In particular, we show that they imply a less steep gradient of decomposition rates from oxic to anoxic conditions than assumed by the standard HPM. We discuss how reliable this pattern is, considering that the data are from heterogeneous studies and not one single controlled experiment, what processes may cause the less steep gradient, and how important the suggested differences in parameter values are for C accumulation predicted by the HPM.

<!--We then provide a list of litterbag experiments one could conduct to specifically test the discrepancies more accurately than possible with currently available litterbag data. -->
<!-- Finally, we use model 3-4 to analyze whether an experiment to constrain the value of $\alpha$ within a range around the value assumed by the HPM ($\alpha = 2$), would be in principle feasible.--> In supporting information \@ref(sup-7), we present R code to predict decomposition rates and remaining masses in litterbag experiments with different species and water table levels with `r hpmd_model_id_to_name("3-4")` [@Teickner.2024b] which can be useful to improve the HPM, test `r hpmd_model_id_to_name("3-4")` against novel litterbag data, or plan litterbag studies.


## Which HPM parameter values differ from their standard values? {#out-discussion-1}

Estimating HPM parameters from litterbag data with `r hpmd_model_id_to_name("3-3")` and `r hpmd_model_id_to_name("3-4")` indicated three discrepancies to their standard values:  

1. There is a large posterior probability that $c_2$ is larger than the standard value of `r hpmd_hpm_standard_parameter_values |> dplyr::filter(variable == "m68_p2") |> dplyr::pull(value)` m. $c_2$ is the anoxia scale length of decomposition and is assumed to represent limitation of anaerobic decomposition below the water table depth as consequences of end product limitation and depletion of electron acceptors [@Frolking.2010]. A larger value implies larger anaerobic decomposition rates at the same depth below the water table.

2. There is a large posterior probability that $W_{opt}$ is larger than the standard value of `r hpmd_hpm_standard_parameter_values |> dplyr::filter(variable == "m69_p1") |> dplyr::pull(value)` L$_\text{water}$ L$_\text{pores}^{-1}$. $W_{opt}$ is the degree of saturation at which the decomposition rate is largest. Larger values mean that the largest decomposition rates are reached at larger degrees of saturation. 

3. For some species, there is a large posterior probability that $k_{0,i}$ is smaller (`r dplyr::intersect(hpmd_stan_draws_3_k0i |> dplyr::filter(Pr(m68_p3_2 < k0) > 0.95) |> dplyr::pull(taxon_rank_value_pretty) |> unique(), hpmd_stan_draws_4_k0i |> dplyr::filter(Pr(m68_p3_2 < k0) > 0.95) |> dplyr::pull(taxon_rank_value_pretty) |> unique()) |> knitr::combine_words()`) or larger (`r dplyr::intersect(hpmd_stan_draws_3_k0i |> dplyr::filter(Pr(m68_p3_2 > k0) > 0.95) |> dplyr::pull(taxon_rank_value_pretty) |> unique(), hpmd_stan_draws_4_k0i |> dplyr::filter(Pr(m68_p3_2 > k0) > 0.95) |> dplyr::pull(taxon_rank_value_pretty) |> unique()) |> knitr::combine_words()`) than the standard value for the HPM microhabitat class we assigned them to. In addition, $k_{0,i}$ was not consistent between `r hpmd_model_id_to_name("3-3")` and `r hpmd_model_id_to_name("3-4")` and also differed between models estimated when removing portions of the data during the cross-validation (supporting Fig. \@ref(fig:sup-hpmd-plot-5)). $k_{0,i}$ defines how decomposition rates differ between *Sphagnum* species and is therefore an important control of C accumulation if there are vegetation changes. 

Of these parameters, $c_2$, and $k_{0,i}$ are of particular relevance for C accumulation in the HPM as indicated by previous sensitivity analyses [@Quillet.2013; @Quillet.2013a]. Explaining the discrepancies and finding ways to test them more accurately than possible with available litterbag data should therefore improve our understanding of peat C accumulation.


## Estimated $c_2$ and $W_{opt}$ suggest larger anaerobic decomposition rates relative to aerobic decomposition rates than the standard HPM {#out-discussion-2}

The discrepancies in $c_2$ and $W_{opt}$ together imply smaller aerobic and larger anaerobic decomposition rates. Since $k_{0,i}$ is the term scaling the decomposition rate to an absolute value, this does not automatically imply smaller absolute aerobic decomposition rates, but larger anaerobic decomposition rates relative to aerobic decomposition rates and consequently a less steep decrease of decomposition rates from oxic to anoxic conditions (Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2)). For the *Sphagnum* species with most data available, both models where HPM parameters were estimated (`r hpmd_model_id_to_name(c("3-3", "3-4")) |> knitr::combine_words(and = " and ")`) estimated a $k_{0,i}$ large enough that anaerobic decomposition rates are also absolutely larger than predicted by the standard HPM (Fig. \@ref(fig:out-p-hpmd-plot-9)).

To illustrate that the estimated $c_2$ and $W_{opt}$ imply smaller aerobic and larger anaerobic decomposition rates, we simulated decomposition of *S. fuscum* incubated at different depths in a peatland with water table depth of `r hpmd_simulation_1_newdata_1 |> dplyr::pull(layer_water_table_depth_to_surface_1) |> unique()` cm below the surface, a porosity of `r hpmd_simulation_1_newdata_1 |> dplyr::pull(layer_total_porosity_1) |> unique()` L$_\text{pores}$ L$_\text{sample}^{-1}$, and a minimum water content at the surface of `r hpmd_simulation_1_newdata_1 |> dplyr::pull(minimum_water_content_at_surface_1) |> unique()` g$_\text{water}$ g$_\text{sample}^{-1}$. We predicted average $k_0$ of *S. fuscum* with `r hpmd_model_id_to_name("3-4")` ($k_{0,\text{modified}}(\text{`r hpmd_model_id_to_name("3-4")`})$) and with `r hpmd_model_id_to_name("3-4")` setting either $c_1$, $W_{opt}$, $f_{min}$, or $c_2$ to the standard value ($k_{0,\text{standard}}(\text{`r hpmd_model_id_to_name("3-4")`})$) and computed their differences. This gives the difference in decomposition rates of `r hpmd_model_id_to_name("3-4")` if we would set individual HPM parameters to their standard values. We plotted this difference versus the depth of the water table below the litter (litter at the surface has a value of +40 cm, litter at the water table level of 0 cm, and litter below the water table level has negative values), as shown in Fig. \@ref(fig:out-sdm-parameters-standard-vs-estimated-p1).

With the standard $W_{opt}$ value, `r hpmd_model_id_to_name("3-4")` predicts larger decomposition rates above and smaller decomposition rates below the water table than when using the parameter values estimated from litterbag data. Similarly, setting $c_2$ to its standard value also results in smaller decomposition rates below the water table level. The other parameters do not have a qualitative influence (Fig. \@ref(fig:out-sdm-parameters-standard-vs-estimated-p1)). Thus, the discrepancies in $W_{opt}$ and $c_2$ are the main drivers of the less steep decrease of decomposition rates from oxic to anoxic conditions in `r hpmd_model_id_to_name("3-4")` compared to the standard HPM.

(ref:out-p-hpmd-plot-9-caption) $k_0$ predicted by HPM modifications (either `r hpmd_model_id_to_name("3-2")`, `r hpmd_model_id_to_name("3-3")`, or `r hpmd_model_id_to_name("3-4")`) minus $k_0$ predicted by the HPM with standard parameter values (`r hpmd_model_id_to_name("3-1")`) versus estimated average water table depths below the litterbags. Points represent average estimates and error bars 95% posterior intervals. *Sphagnum* spec. are samples which have been identified only to the genus level. Only data for species with at least three replicates are shown.

```{r out-p-hpmd-plot-9, fig.cap='(ref:out-p-hpmd-plot-9-caption)', out.width="90%"}
knitr::include_graphics(tar_read(hpmd_plot_9))
```

(ref:out-sdm-parameters-standard-vs-estimated-p1-caption) Difference between decomposition rates for *S. fuscum* predicted with parameter values estmated by `r hpmd_model_id_to_name("3-4")` ($k_{0,\text{modified}}(\text{`r hpmd_model_id_to_name("3-4")`})$), and when setting the HPM parameter in the panel title to its standard value ($k_{0,\text{standard}}(\text{`r hpmd_model_id_to_name("3-4")`})$). Panels show results when different parameters are set to their standard values. Positive $k_{0,\text{modified}}(\text{`r hpmd_model_id_to_name("3-4")`}) - k_{0,\text{standard}}(\text{`r hpmd_model_id_to_name("3-4")`})$ means that decomposition rates are larger when using the estimated parameter value compared to using the standard parameter value.     

```{r out-sdm-parameters-standard-vs-estimated-p1, fig.cap='(ref:out-sdm-parameters-standard-vs-estimated-p1-caption)', out.width="100%"}
knitr::include_graphics(tar_read(hpmd_simulation_1_plot_1))
```



## Reliability of the identified discrepancies {#out-discussion-3}

Before analyzing potential causes of the discrepancies found for $c_2$ and $W_{opt}$ we first ask if combining different litterbag experiments is reliable evidence for the less steep gradient in decomposition rates from oxic to anoxic conditions.

If we take a look at the misfits of the standard HPM (`r hpmd_model_id_to_name("3-1")`) shown in Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2), many, but not all underestimations of aerobic decomposition rates could have been caused by other factors: For example for *S. balticum* the difference may have been caused by differences in the two litterbag experiments from which we collected the data because the replicate with positive water table depth is from @Strakova.2010, whereas the two others are from @Makila.2018. 

The less pronounced gradient in measured decomposition rates above the water table depth is, however, also visible for *S. fuscum* replicates within the same study [@Johnson.1991; @Golovatskaya.2017; @Makila.2018] and in addition similar across these (independent) studies (supporting information \@ref(sup-8)), indicating that this pattern cannot be explained in all cases by differences between studies. In addition, during the cross-validation, we removed data from individual studies from the model and the remaining subsets still resulted in similar estimates for $c_2$ and $W_{opt}$ (supporting Fig. \@ref(fig:sup-hpmd-plot-5)). Finally, numerous previous studies suggest that water table depth is an important control of decomposition rates (e.g., @Blodau.2004) and one may therefore expect that also between different studies decomposition rate differences should be controlled to a large degree by differences in water table depths. Thus, even with the heterogeneous litterbag data which is currently available, a less steep gradient of decomposition rates from oxic to anoxic conditions appears to be replicable between studies and species. Controlled litterbag experiments should test this.

A larger $W_{opt}$ is in line with a study where the largest decomposition rates of the same litter type were observed at or just above the average water table level in hummocks [@Belyea.1996], and with maximum CO$_2$ production rates around 13 cm above the water table level in a mesocosm study [@Blodau.2004]. According to the ModGberg model the degree of saturation at this depth is near the $W_{opt}$ suggested by `r hpmd_model_id_to_name("3-3")` and `r hpmd_model_id_to_name("3-4")`. For example, for our simulation analysis used to produce Fig. \@ref(fig:out-sdm-parameters-standard-vs-estimated-p1), the average $W_{opt}$ estimated by model `r hpmd_model_id_to_name("3-4")` (`r hpmd_stan_draws_4 |> dplyr::filter(index_hpm) |> dplyr::slice(1) |> dplyr::pull(m69_p1) |> mean() |> round(2)` L$_\text{water}$ L$_\text{pores}^{-1}$) is reached around `r hpmd_simulation_1_newdata_1 |> dplyr::filter(layer_degree_of_saturation_1 <= (hpmd_stan_draws_4 |> dplyr::filter(index_hpm) |> dplyr::slice(1) |> dplyr::pull(m69_p1) |> mean())) |> dplyr::slice_tail(n = 1) |> dplyr::mutate(res = sample_depth_lower - layer_water_table_depth_to_surface_1) |> dplyr::pull(res) |> abs()` cm above the water table level, as shown in Fig. \@ref(fig:out-sdm-parameters-standard-vs-estimated-p2). At shallower depths, the degree of saturation decreases below $W_{opt}$ which would decrease decomposition rates as observed in @Belyea.1996. In contrast, according to the the ModGberg model, a degree of saturation corresponding to the standard $W_{opt}$ value (`r hpmd_hpm_standard_parameter_values |> dplyr::filter(variable == "m69_p1") |> dplyr::pull(value)` L$_\text{water}$ L$_\text{pores}^{-1}$) is reached at shallower depths and in the same simulation with this standard $W_{opt}$ value, no pronounced sub-surface peak in decomposition rates is observed (supporting Fig. \@ref(fig:sup-hpmd-simulation-1-plot-5)). In hollows, the optimum degree of saturation suggested by `r hpmd_model_id_to_name("3-4")` is reached near the surface for either $W_{opt}$ value (supporting Fig. \@ref(fig:sup-hpmd-simulation-1-plot-5)). The $W_{opt}$ suggested by `r hpmd_model_id_to_name("3-4")` is also near the average optimum of heterotrophic respiration estimated across a range of mineral soils [@Moyano.2013]. Thus, a larger $W_{opt}$ would be compatible with results from several previous studies.

Larger and smaller $c_2$ than the standard value have been estimated for several permafrost peatland cores with a modified version of the HPM with monthly time step [@Treat.2021; @Treat.2022]. Smaller values have been estimated for tropical peatlands [@Kurnianto.2015]. To our knowledge, no litterbag experiment directly estimated $c_2$. A difficulty is that available litterbag experiments cover only a comparatively small depth below the water table level (at most around 30 cm, Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2)) and therefore gradients in anaerobic decomposition rates across larger depths below the water table currently cannot be estimated. 

(ref:out-sdm-parameters-standard-vs-estimated-p2-caption) Decomposition rates predicted with `r hpmd_model_id_to_name("3-4")` ($k_{0,\text{modified}}(\text{`r hpmd_model_id_to_name("3-4")`})$) for *S. fuscum* (hummocks), using either the standard value for $W_{opt}$ or the $W_{opt}$ value estimated by `r hpmd_model_id_to_name("3-4")` versus depth of the litter below the peat surface. The horizontal line is the average water table depth.     

```{r out-sdm-parameters-standard-vs-estimated-p2, fig.cap='(ref:out-sdm-parameters-standard-vs-estimated-p2-caption)', out.width="60%"}
knitr::include_graphics(tar_read(hpmd_simulation_1_plot_2))
```


## Water table fluctuations may explain the discrepancies in $c_2$ and $W_{opt}$ and larger anaerobic and smaller aerobic decomposition rates. {#out-discussion-4}

The HPM predicts decomposition rates based on average annual water table depths [@Frolking.2010]. Our evaluation of the HPM also assumed an average water table depth during the litterbag experiments and the HPM translated this into a clear pronounced transition between anaerobic and aerobic decomposition rates (Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2)). In reality, water table depths fluctuate and this causes transient and nonlinear changes in decomposition rates due to variations in the availability of oxygen and other electron acceptors, flushing of end products of anaerobic decomposition, and possibly other factors [@Siegel.1995; @Blodau.2003; @Blodau.2004; @Beer.2007; @Knorr.2009; @Walpen.2018; @Campeau.2021; @Kim.2021; @Treat.2022; @Obradovic.2023]. A possible explanation why the gradient in decomposition rate from oxic to anoxic decomposition is less steep, on average across litterbag experiments, than suggested by the standard HPM could therefore be that an averaging effect of fluctuating water table levels on both aerobic and anaerobic decomposition rates is neglected by the HPM. 

<!--This suggestion may be incomplete because larger $c_2$ values have also been estimated for a modification of the HPM with monthly time step [@Treat.2021; @Treat.2022] and because $c_2$ can be expected to differ between sites and over time, for example due to droughts or differences in groundwater flow (e.g. @Siegel.1995). Therefore, $c_2$ may differ between litterbag studies and our data only indicate that $c_2$ may on average be larger, whereas more research is necessary to estimate and understand site-specific controls of $c_2$ and temporal changes caused by changes in hydrology.-->

An additional factor may be that litterbags are buried over a depth range, but we assumed a single fixed depth. If the buried litterbags cover some depth range, this would spatially average decomposition rates, with similar effects as the temporal average caused by water table fluctuations.

According to our results, $c_2$ would have to be re-interpreted as transition parameter that accounts both for limitation of anaerobic decomposition under anoxic conditions and for the effects of periodically oxic conditions. Similarly, $W_{opt}$ would have to be re-interpreted as the optimum average degree of saturation for decomposition under water table level variations and its value would be necessarily different from the optimum degree of saturation for depolymerization under static degree of saturation.

Adjusting the HPM parameters as implied by our modified models may be an easy way to account for the effect of sub-annual variation in water table levels on decomposition rates, if the discrepancies are caused by fluctuating water tables and if the model is representative for different effects variations in water table level may have on decomposition rates (e.g. short-term fluctuations compared to seasonal water table variations compared to prolonged droughts). What we have not considered due to limited data is that $c_2$ can be expected to depend on long-term changes in groundwater flow (e.g., @Siegel.1995) or site-specific differences in hydrology and other factors (e.g., @Treat.2021, @Treat.2022). Therefore, $c_2$ may differ between litterbag studies and our data only indicate that $c_2$ is larger on average, whereas more research is necessary to estimate and understand site-specific controls of $c_2$ and how a change in hydrology controls $c_2$. Similarly, $W_{opt}$ may differ between sites and over time. It would be interesting to know whether litterbag experiments can quantify these controls and whether $c_2$ estimated from litterbag experiments is generally larger in peatlands with larger water table fluctuations. 


<!--Available litterbag data do not report temporally resolved water table data and therefore do not allow to test whether the standard HPM would correctly predict decomposition rates were such data available. The HPM assumes an annual resolution for changes in water table depth. Even if such data were available, it would have to be analyzed how such effects would interact with other modules of the model. -->


## Implications of the discrepancies in $W_{opt}$ and $c_2$ for long-term C accumulation {#out-discussion-5}

A larger $c_2$ implies larger anaerobic decomposition and may thus indicate that the HPM underestimates anaerobic decomposition rates. Previous sensitivity analyses identified $c_2$ as influential for C accumulation in the HPM [@Quillet.2013; @Quillet.2013a].

If $c_2$ is varied within the range from the standard value (`r hpmd_hpm_standard_parameter_values |> dplyr::filter(variable == "m68_p2") |> dplyr::pull(value)` m) to the average posterior estimate from `r hpmd_model_id_to_name("3-4")` (`r hpmd_stan_draws_4 |> dplyr::filter(index_hpm) |> dplyr::slice(1) |> dplyr::pull(m68_p2) |> mean() |> round(2)` m), this would cause differences in C accumulation predicted by HPM of a maximum of ca. 20% in the sensitivity experiment of @Quillet.2013 (depending on precipitation, Fig. 1 c in @Quillet.2013). If values are changed across the complete posterior range compatible with litterbag data and if other HPM parameters would also be varied (Fig. 2 c in @Quillet.2013), the effect would be even larger. 

Due to parameter interactions and feedbacks, an increase in anaerobic decomposition rates can result in smaller or larger C accumulation of the HPM, depending on environmental conditions [@Quillet.2013]. Small anaerobic decomposition may cause too rapid C accumulation resulting in a low water table level, a thick aerobic zone, and thus smaller overall C accumulation after a longer time. Larger anaerobic decomposition may result in higher water table levels and this can increase C accumulation in the long-term. Too large anaerobic decomposition decreases C accumulation [@Quillet.2013].

A larger $W_{opt}$ implies that the largest aerobic decomposition rates are reached under more saturated conditions. $W_{opt}$ has not been identified as influential in a sensitivity analysis of the HPM [@Quillet.2013], but as shown above, it contributes to the less steep decrease of decomposition rates from oxic to anoxic conditions. Importantly, since the HPM does not have a seasonally resolved water table depth, the two sensitivity analyses did not consider how seasonal variations of the water table depth may control long-term C accumulation, and consequently the re-interpreted $W_{opt}$ may be more important to long-term C accumulation than previously assumed. In addition, `r hpmd_model_id_to_name("3-4")` suggests an average $W_{opt}$ value of `r hpmd_stan_draws_4 |> dplyr::filter(index_hpm) |> dplyr::slice(1) |> dplyr::pull(m69_p1) |> mean() |> round(2)` L$_\text{water}$ $_\text{pores}^{-1}$, which is outside the range of values tested in @Quillet.2013 (0.3 to 0.5 L$_\text{water}$ $_\text{pores}^{-1}$). This implies that the sensitivity of long-term C accumulation to $W_{opt}$ has been evaluated over a too small range.

A further aspect that needs to be considered is that `r hpmd_model_id_to_name("3-3")` and `r hpmd_model_id_to_name("3-4")` estimate parameter distributions based on available data, whereas existing studies defined fixed parameter values or ranges of parameter values based on expert knowledge. Based on @Quillet.2013, the uncertainties would cause non-negligible differences in predicted long-term C accumulation. For example, values within the uncertainty range of $c_2$ estimated by `r hpmd_model_id_to_name("3-4")` ((`r hpmd_stan_draws_4 |> dplyr::filter(index_hpm) |> dplyr::slice(1) |> dplyr::pull(m68_p2) |> posterior::quantile2(probs = c(0.025, 0.975)) |> round(2) |> knitr::combine_words(and = ", ")`), 95% confidence interval), would imply differences up to 100 kg m$^{-2}$ of accumulated C over 5000 years in some simulations (Fig. 1 (c) in @Quillet.2013, with a maximum total accumulation of ca. 430 kg$_\text{C}$ m$^{-2}$). Simulations of remaining masses for different *Sphagnum* species under different conditions also indicate large uncertainties in predicted remaining masses (supporting info \@ref(sup-11)). This implies that more work is required to estimate parameters accurately enough to detect even relative large differences among long-term peatland models and between model predictions and peat cores.   

Summarized, based on existing sensitivity analyses of the HPM the parameter discrepancies suggested by `r hpmd_model_id_to_name("3-3")` and `r hpmd_model_id_to_name("3-4")` can translate into non-negligible differences in long-term C accumulation rates. They also imply gaps in previous sensitivity analyses of the HPM, namely that $W_{opt}$ has been analyzed over a too restricted value range and may play a more important role if water table fluctuations are taken into account. 


<!--

## Is the HPM compatible with available litterbag data?

### Does the HPM underestimate the anoxic scale length $c_2$?

A larger $c_2$ implies larger anaerobic decomposition and may thus indicate that the HPM underestimates anaerobic decomposition rates. $c_2$ has been identified as influential for C accumulation in the HPM [@Quillet.2013; @Quillet.2013a]. 

If $c_2$ is varied within the range from the standard value (`r hpmd_hpm_standard_parameter_values |> dplyr::filter(variable == "m68_p2") |> dplyr::pull(value)` m) to the average posterior estimate from model 3-4 (`r hpmd_stan_draws_4 |> dplyr::filter(index_hpm) |> dplyr::slice(1) |> dplyr::pull(m68_p2) |> mean() |> round(2)` m), this would cause differences in C accumulation predicted by HPM of a maximum of 20% in the sensitivity experiment of @Quillet.2013 (depending on precipitation, Fig. 1 c in @Quillet.2013). If values are changed across the complete posterior range compatible with litterbag data and if other HPM parameters would also be varied (Fig. 2 c in @Quillet.2013), the effect would be larger. 

Due to parameter interactions, an increase in anaerobic decomposition rates can result in smaller or larger C accumulation of the HPM, depending on environmental conditions [@Quillet.2013]. Small anaerobic decomposition may cause too rapid C accumulation resulting in a low water table level, a thick aerobic zone, and thus smaller overall C accumulation after a longer time. Larger anaerobic decomposition may result in higher water table levels and this can increase C accumulation in the long-term. Too large anaerobic decomposition decreases C accumulation [@Quillet.2013].

Two alternative factors may explain why $c_2$ estimated from litterbag data is larger than the standard value:

1. Water table dynamics: In our models, we used average water table depths and the HPM translated this into a clear pronounced transition between anaerobic and aerobic decomposition rates (Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2)). Under natural conditions, the water table level varies during a litterbag experiment and this should result in a more smooth transition between aerobic and anaerobic decomposition rates and in particular in larger anaerobic decomposition rates than estimated by the HPM (model 3-1), exactly what the litterbag data imply (Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2)).

2. Uncertainty of the depth litterbags were buried in: In addition to the first factor, we assumed a fixed depth at which litterbags were buried. If these depth values are not accurate, this would have similar consequences as the first factor.

The larger $c_2$ in the modified HPM may thus not be caused by an incorrect representation of (completely) anaerobic decomposition rates, but by an incorrect rerpesentation of anoxic and oxic conditions during litterbag experiments when using average water table depths. In this case, $c_2$ would have to be re-interpreted as transition parameter which accounts both for limitation of anaerobic decomposition under anoxic conditions and for the effects of periodically oxic conditions. [---todo: Actually, both processes are related since WTL fluctuations also influence the end product accumulation: A decrease of the WTL causes degassing of CO2and CH4 and therefore increases decomposition rates at depth. See @Blodau.2004. I should include this somewhere.]


### Does the HPM underestimate the optimum degree of saturation for aerobic decomosition $W_{opt}$?

A larger $W_{opt}$ implies that the largest aerobic decomposition rates are reached under more saturated conditions. $W_{opt}$ has not been identified as influential in a sensitivity analysis of the HPM [@Quillet.2013], but as shown above, it contributes to the less steep decrease of decomposition rates from oxic to anoxic conditions.

A larger $W_{opt}$ is in line with a study where the largest decomposition rates of the same litter were observed at or just above the average water table level in hummocks, but were smaller above [@Belyea.1996] and with maximum CO$_2$ production rates around 13 cm above the water table level in a mesocosm study [@Blodau.2004]. According to the ModGberg model the degree of saturation at this depth is near the $W_{opt}$ suggested by models 3-3 and 3-4. For example, for our simulation analysis used to produce Fig. \@ref(fig:out-sdm-parameters-standard-vs-estimated-p1), the average $W_{opt}$ estimated by model 3-4 (`r hpmd_stan_draws_4 |> dplyr::filter(index_hpm) |> dplyr::slice(1) |> dplyr::pull(m69_p1) |> mean() |> round(2)` L$_\text{water}$ L$_\text{pores}^{-1}$) is reached around `r hpmd_simulation_1_newdata_1 |> dplyr::filter(layer_degree_of_saturation_1 <= (hpmd_stan_draws_4 |> dplyr::filter(index_hpm) |> dplyr::slice(1) |> dplyr::pull(m69_p1) |> mean())) |> dplyr::slice_tail(n = 1) |> dplyr::mutate(res = sample_depth_lower - layer_water_table_depth_to_surface_1) |> dplyr::pull(res) |> abs()` cm above the water table level, as shown in Fig. \@ref(fig:out-sdm-parameters-standard-vs-estimated-p2)). At shallower depths, the degree of saturation decreases below $W_{opt}$ which would decrease decomposition rates as observed in @Belyea.1996. In contrast, according to the the ModGberg model a degree of saturation corresponding to the standard $W_{opt}$ value (`r hpmd_hpm_standard_parameter_values |> dplyr::filter(variable == "m69_p1") |> dplyr::pull(value)` L$_\text{water}$ L$_\text{pores}^{-1}$) is reached at shallower depths and in the same simulation with this standard $W_{opt}$ value, no sub-surface peak in decomposition rates is observed (supporting Fig. \@ref(fig:sup-hpmd-simulation-1-plot-5)). In hollows, the optimum degree of saturation suggested by model 3-4 is reached near the surface for either $W_{opt}$ value (supporting Fig. \@ref(fig:sup-hpmd-simulation-1-plot-5)).

Since the HPM does not have a seasonally resolved water table, the two sensitivity analyses did not consider how seasonal variations of the water table may control long-term C accumulation, and consequently the re-interpreted $W_{opt}$ may be more important to long-term C accumulation than assumed by the HPM.

Similar to $c_2$, the discrepancies we have observed may also have been caused by the effects of water table fluctuations and uncertainties about burying depths on decomposition rates, instead of implying that aerobic decomposition rates would be optimal under wetter conditions. Here, water table level variations would change the degree of saturation in peat layers above the lowest water table level, which could temporarily increase oxygen availability in layers with otherwise larger degree of saturation, apparently shifting the optimum for aerobic decomposition to larger degrees of saturation. In this case, $W_{opt}$ would have to be re-interpreted as the optimum average degree of saturation for decomposition under water table level variations.

Taken together, our "water table level variation" hypothesis also seems to be a plausible alternative (or additional) explanation for the observed less steep gradient in decomposition rates from oxic to anoxic conditions and for the discrepancies in $c_2$ and $W_{opt}$.
-->



<!--## Adjusting the standard values for $c_2$ and $W_{opt}$ may improve predictions of the HPM {#out-discussion-6}

Since the HPM uses annual water table depths to compute decomposition rates, it cannot account for how they may be modified by water table fluctuations. Thus, if the less steep decrease of decomposition rates along the gradient from oxic to anoxic conditions is reliable, it indicates that the HPM overestimates the decline of decomposition rates below the annual average water table depth in available litterbag data, irrespective of whether the HPM misfits parameters or whether `r hpmd_model_id_to_name("3-4")` misrepresents water table depth variations during decomposition in litterbag experiments.

Since water table fluctuations and groundwater flow control the limitation of anaerobic decomposition rates due to energetic limitation by accumulation of decomposition end products, regeneration of depleted electron acceptors and potentially other factors [@Siegel.1995; @Blodau.2003; @Blodau.2004; @Walpen.2018; @Joshi.2021; @Campeau.2021; @Kim.2021] it would not be surprising if a better representation of decomposition rates requires both an improvement of existing models as well as litterbag experiments to specifically quantify these controls, or better linking litterbag experiments to incubations with gas flux and dissolved organic matter production measurements.

Adjusting the HPM parameters as implied by our modified models may be an easy way to account for the effect of sub-annual variation in water table levels on decomposition rates, if the discrepancies are caused by fluctuating water tables and if the model is representative for different effects variations in water table level may have on decomposition rates (e.g. short-term fluctuations compared to seasonal water table variations compared to prolonged droughts). However, if long-term changes in groundwater flow (e.g. @Siegel.1995) or site-specific differences in hydrology and other factors (e.g. @Treat.2021, @Treat.2022) are dominant controls of $c_2$, modifications of the model structure are probably necessary. It would be interesting to know whether litterbag experiments can quantify such controls.
--> 

## Large errors in $k_{0,i}$ estimates for individual species cause large errors in decomposition rates predicted by the HPM {#out-discussion-7}

We found some discrepancies between the maximum potential decomposition rates ($k_{0,i}$) `r hpmd_model_id_to_name("3-4")` estimated for some species and the standard HPM values after assigning species to the three HPM microhabitat PFT (hollow, lawn, hummock *Sphagnum* mosses), however as noted above, these discrepancies were neither consistent between the two modifications of the HPM (`r hpmd_model_id_to_name("3-3")` and `r hpmd_model_id_to_name("3-4")`) (supporting information \@ref(sup-5)), nor when `r hpmd_model_id_to_name("3-4")` was fitted to different subsets of the data during cross-validation (supporting Fig. \@ref(fig:sup-hpmd-plot-5)). 

Altogether, this indicates that the $k_{0,i}$ for many of the *Sphagnum* species are difficult to estimate from available litterbag data and more research should address this task. For example, `r hpmd_model_id_to_name("3-4")` could be extended, with suitable data, by modelling how $k_{0,i}$ is controlled by factors such as temperature or within-species differences in litter chemistry. 

We expect that better estimating $k_{0,i}$ is an important step to improve the predictive accuracy of the HPM because the cross-validation of `r hpmd_model_id_to_name("3-4")` indicated a larger RMSE$_\text{test}$ than RMSE$_\text{train}$, with only small variability in estimates of $c_1$, $W_{opt}$, $f_{min}$, and $c_2$, but much more variability in estimates of $k_{0,i}$. This indicates that a large part of the difference between RMSE$_\text{test}$ and RMSE$_\text{train}$ of `r hpmd_model_id_to_name("3-4")` may be explained by missing information about $k_{0,i}$. 

Moreover, as noted above, $k_{0,i}$ scales the relative differences in anaerobic versus aerobic decomposition rates to absolute decomposition rates. For example, as shown in Fig. \@ref(fig:out-p-hpmd-plot-9), `r hpmd_model_id_to_name("3-4")` indicates that the standard HPM underestimates aerobic and anaerobic decomposition rates for *S. angustifolium* and *S. magellanicum aggr.* litterbag data, whereas for *S. fuscum* only anaerobic decomposition rates are underestimated.

Values of $k_{0,i}$ can be estimated more accurately if decomposition rates in the litterbag experiments can be estimated more accurately and there is again a direct link to initial leaching losses. Our analysis of differences in behavior of `r hpmd_model_id_to_name(c("3-1", "3-2", "3-3", "3-4")) |> knitr::combine_words(and = " and ")` suggests that `r hpmd_model_id_to_name(c("3-2", "3-3")) |> knitr::combine_words(and = " and ")` produced smaller decomposition rate estimates and larger initial leaching loss estimates to make the litterbag data compatible with the (smaller predictions of the) HPM, whereas `r hpmd_model_id_to_name("3-4")` did not (Fig. \@ref(fig:out-sdm-all-models-p2)) and consequently had larger estimates for $k_{0,i}$ than the other two models (Fig. \@ref(fig:out-p-hpm-mm27-2-mm29-1-mm30-1-p2)). Thus, more accurate estimation of initial leaching losses --- which vary a lot for the same species between different studies [@Teickner.2024] --- should make decomposition rate estimates more accurate, and this should improve accuracy of $k_{0,i}$ in the HPM, according to our analyses.


<!--## How to design litterbag experiments to test the discrepancies?

Our study suggests a non-negligible role of initial leaching losses in *Sphagnum* litterbag experiments. If we can estimate initial leaching losses more accurately, this should improve the accuracy of decomposition rate estimates for individual litterbag experiments, and of estimates for the maximum possible decomposition rates of individual *Sphagnum* species, according to our analyses, and it should also enable experimenters to better test and avoid biases when comparing mass losses due to decomposition between experimental groups. [---todo: decide whether to move this somewhere else or remove]


### How to design litterbag experiments to test water table variation effects on $W_{opt}$?

Alone based on theoretical considerations, $W_{opt}$ can be shown to depend on many soil properties which means that a fixed $W_{opt}$ will not be suitable for all situations [@Moyano.2013]. Such dependencies are best tested in laboratory experiments with steady conditions. [---todo: decide whether to move or remove].

To test whether our estimate of $W_{opt}$ (as estimate of the degree of saturation where the maximum decomposition rate is reached at a specific point in time) is confounded by water table variations, litterbags should be incubated under controlled conditions in the lab under different constant moisture levels. For each moisture level, decomposition rates can be estimated and from these $W_{opt}$ and $c_2$.

To test whether a change in moisture conditions over time would alter the estimated $W_{opt}$ and $c_2$, one can computationally simulate changes in moisture conditions over time and use the decomposition rate estimates from the experiment under constant conditions to predict remaining masses for the same time points as the litterbag experiment, and estimate decomposition rates and $W_{opt}$ for these simulated experiments. This gives allows to estimate the dampening effect water level fluctuations may have on how fast decomposition rates decrease along the gradient from oxic to anoxic conditions and it allows to test whether the implied differences in $W_{opt}$ and $c_2$ match those implied by model 3-4.

In addition, one could conduct a second experiment with water table variation treatments, record moisture continuously, estimate decomposition rates and average degrees of saturation, and compute $W_{opt}$ for this experiment. As water table variations may influence decomposition via other pathways than just changing the water content, the difference between $W_{opt}$ in the computer simulation and the real water level variation experiment represents the additional facilitation or limitation of decomposition due to effects of water level variations other than changing the degree of saturation (e.g. [---todo:ref]).
-->

<!-- ## Can $\alpha$ be more accurately estimated from litterbag experiments with fresh litter? {#out-discussion-experiment-1-alpha}

It is difficult to estimate $\alpha$ from litterbag experiments because different values of $\alpha$ cause only small differences in predicted remaining masses within typical durations of litterbag experiments [@Teickner.2024], however it may not be entirely impossible to give more exact boundaries for $\alpha$, at least for some case, than that it is larger than 1 and smaller than 3 [@Frolking.2001]. 

Assume we have two identical types of fresh litter (identical $k_{0,i}$) which we decompose under identical constant conditions and a constant degree of saturation of 0.6 L$_\text{water}$ L$_\text{pores}^{-1}$, but their decomposition differs in $\alpha$. For example, we may assume as null hypothesis the value used in the HPM ($\alpha = 2$) and as alternative hypothesis a smaller value, say $\alpha = 1.5$. Fig. \@ref(fig:out-sdm-experiment-alpha-p1-p2) (a) shows, for two *Sphagnum* litters with contrasting $k_{0,i}$ (*S. fuscum* and *S. angustifolium*) the difference of average remaining masses versus the incubation duration. This difference is, on average, largest after approximately `r hpmd_simulation_1_newdata_3$newdata_1 |> dplyr::filter(hpm_taxon_rank_value == "Sphagnum fuscum") |> dplyr::filter(mean(mass_relative_mass_mu_diff) >= max(mean(mass_relative_mass_mu_diff))) |> dplyr::slice(1) |> dplyr::pull(incubation_duration)` years for *S. fuscum* and `r hpmd_simulation_1_newdata_3$newdata_1 |> dplyr::filter(hpm_taxon_rank_value == "Sphagnum angustifolium") |> dplyr::filter(mean(mass_relative_mass_mu_diff) >= max(mean(mass_relative_mass_mu_diff))) |> dplyr::slice(1) |> dplyr::pull(incubation_duration)` years for *S. angustifolium*. In addition, we can see that the species with larger $k_{0,i}$, *S. angustifolium*, reaches a larger average difference in shorter time. To maximize our chance to experimentally detect a difference in remaining masses when litter decomposes with $\alpha = 1.5$ compared to the HPM standard value ($\alpha = 2$), it would therefore be the best to use litter of a species with large decomposition rates and decompose it approximately `r hpmd_simulation_1_newdata_3$newdata_1 |> dplyr::filter(hpm_taxon_rank_value == "Sphagnum angustifolium") |> dplyr::filter(mean(mass_relative_mass_mu_diff) >= max(mean(mass_relative_mass_mu_diff))) |> dplyr::slice(1) |> dplyr::pull(incubation_duration)` years. To make the experiment practically more manageable, we assume an incubation duration of `r hpmd_simulation_1_newdata_3$newdata_2 |> dplyr::slice(1) |> dplyr::pull(incubation_duration)` years which amounts to an average mass difference of `r hpmd_simulation_1_newdata_3$newdata_1 |> dplyr::filter(hpm_taxon_rank_value == "Sphagnum angustifolium" & incubation_duration == (hpmd_simulation_1_newdata_3$newdata_2 |> dplyr::slice(1) |> dplyr::pull(incubation_duration))) |> dplyr::pull(mass_relative_mass_mu_diff) |> mean() |> magrittr::multiply_by(100) |> round()` (`r hpmd_simulation_1_newdata_3$newdata_1 |> dplyr::filter(hpm_taxon_rank_value == "Sphagnum angustifolium" & incubation_duration == (hpmd_simulation_1_newdata_3$newdata_2 |> dplyr::slice(1) |> dplyr::pull(incubation_duration))) |> dplyr::pull(mass_relative_mass_mu_diff) |> posterior::quantile2(probs = c(0.025, 0.975)) |> magrittr::multiply_by(100) |> round() |> knitr::combine_words(and = ", ")`) percent of the initial mass (mean and 95% prediction interval).

Until now, we have compared average remaining masses, but experiments produce remaining masses for individual samples. To check whether we may, with high probability, detect a difference in a litterbag experiment, we used model 3-4 to predict 100 potential sample masses for the above described experiment and for each value of $\alpha$. We then computed averages using the first, the first two, etc., up to all `r hpmd_simulation_1_newdata_3$newdata_2 |> dplyr::filter(hpm_taxon_rank_value == "Sphagnum angustifolium") |> nrow()` samples and then computed the difference of the computed averages between the two $\alpha$ values. In Fig. \@ref(fig:out-sdm-experiment-alpha-p1-p2) (b) we show the result by plotting the estimated difference versus the sample size of litter bag replicates from which we computed the averages. This analysis suggests that we can test with a probability of 95% whether $\alpha$ is smaller than 2 if we use approximately 50 litterbag replicates if $\alpha$ is at most 1.5 in reality (assuming that our model gives a reasonable approximation of the expected remaining masses and uncertainties). For *S. fuscum*, no such reliable test is possible with the same number of replicates, according to model 3-4 (Fig. \@ref(fig:out-sdm-experiment-alpha-p1-p2) b).

The same analysis with $\alpha = 2.5$ can be used to check whether it may be possible to test with a probability of 95% whether $\alpha$ is larger than 2  with a reasonable amount of samples, if it is at least 2.5 in reality (Fig. \@ref(fig:out-sdm-experiment-alpha-2-p1-p2)). Here, around `r hpmd_simulation_1_newdata_4$newdata_2 |> dplyr::filter(hpm_taxon_rank_value == "Sphagnum angustifolium") |> dplyr::pull(index) |> which()` *S. angustifolium* litterbags incubated for 5 years at a constant degree of saturation of 0.6 L$_\text{water}$ L$_\text{pores}^{-1}$ would be needed. Thus, with `r hpmd_simulation_1_newdata_4$newdata_2 |> dplyr::filter(hpm_taxon_rank_value == "Sphagnum angustifolium") |> dplyr::pull(index) |> which()` litterbag replicates it may be possible to test whether $1.5 \le \alpha \le 2.5$ for *S. angustifolium* under controlled conditions and if initial leaching losses are explicitly considered. $\alpha$ may differ between species or in response to differences in microbial activities and our analysis implies that different approaches than litterbag experiments of fresh litter would probably be required for more detailed analyses.

(ref:out-sdm-experiment-alpha-p1-p2-caption) (a) Average remaining masses assuming $\alpha=2$ minus average remaining masses assuming $\alpha=1.5$ as predicted by model 3-4 versus incubation duration for *S. angustifolium* and *S. fuscum* decomposing under oxic conditions at a degree of saturation of `r hpmd_simulation_1_newdata_3$newdata_1 |> dplyr::slice(1) |> dplyr::pull(layer_degree_of_saturation_1)` L$_\text{water}$ L$_\text{pores}^{-1}$. (b) Difference of averages of remaining masses computed on 1, 2, ..., 100 samples using model 3-4 for the same experiment as in (a) versus the number of samples used to compute the average difference. 

```{r out-sdm-experiment-alpha-p1-p2, fig.cap='(ref:out-sdm-experiment-alpha-p1-p2-caption)', out.width="80%"}
knitr::include_graphics(tar_read(hpmd_simulation_1_plot_3))
```

(ref:out-sdm-experiment-alpha-2-p1-p2-caption) Same as Fig. \@ref(fig:out-sdm-experiment-alpha-p1-p2), but assuming $\alpha = 2.5$ instead of $\alpha = 1.5$.

```{r out-sdm-experiment-alpha-2-p1-p2, fig.cap='(ref:out-sdm-experiment-alpha-2-p1-p2-caption)', out.width="80%"}
knitr::include_graphics(tar_read(hpmd_simulation_1_plot_4))
```
-->

<!--
Solving equation \@ref(eq:decomposition-differential-1) for $\alpha$ gives:

$$
\frac{dm(t)}{dt} = -k_0 m_0 \left(\frac{m(t)}{m_0}\right)^\alpha\\
k = \frac{-dm(t)}{dt}\\ 
\ln \left(\frac{k}{k_0 m_0} \right) = \alpha \ln \left( \frac{m(t)}{m_0} \right)\\
\alpha = \frac{\ln(k) - \ln(k_0 m_0)}{\ln(m(t)) - \ln(m_0)}
$$

```{r}
f1 <- function(k, k0, m0, mt) {
  (log(k) - log(k0 * m0)) / (log(mt) - log(m0))
}

curve(f1(0.01, k0 = 0.05, m0 = 1, mt = x), ylim = c(0, 4))
curve(f1(0.01, k0 = 0.15, m0 = 1, mt = x), add = TRUE, lty = 2)

f2 <- function(alpha, k0, m0, mt) {
  k0 * m0 * (mt/m0)^alpha
}

curve(f2(1, k0 = 0.15, m0 = 1, mt = x))
curve(f2(2, k0 = 0.15, m0 = 1, mt = x), add = T, lty = 2)

curve(f2(1, k0 = 0.05, m0 = 1, mt = x))
curve(f2(2, k0 = 0.05, m0 = 1, mt = x), add = T, lty = 2)
curve(f2(1.5, k0 = 0.05, m0 = 1, mt = x), add = T, lty = 3)

```



$$
m(t) = \frac{m_0}{(1 + (\alpha - 1) k_0 t)^{\frac{1}{\alpha - 1}}}
$$
-->

<!--
## Steps to design and analyze litterbag studies to test dynamic peatland models



We have only analyzed the data with the HPM, but the observed patterns are relevant to all dynamic peatland models. Here, we list what information is most needed from systematic litterbag experiments to reliably test the observed patterns and suggested mechanisms:

1. To test whether water table fluctuations indeed dampen the relation of decomposition rates with the average water table depth, one could incubate litter from different species in mesocosms with the water table either fixed or fluctuating in some range. Litterbags should be placed at high depth resolution within a region around the water table depth. This experiment can directly compare whether decomposition rates decrease more strongly at the average water table level when there are no water table fluctuations.

2. To test whether $c_2$ is underestimated by the standard HPM, litterbags from different species should be buried at different depths, covering a large depth gradient (say 2 m) below the average water table depth. To exclude dampening effects, this experiment should be combined with (the results of) experiment 1.

3. To test the effect of $\alpha$ on the decomposition rate, one can conduct a two-stage litterbag experiment, where litter is decomposed in a first experiment and retrieved at different time points. This generates samples with $m_{i,0}$ ranging from 100 percent of the initial mass ($\frac{m_i}{m_{i,0}}$ = 1) to some small value where $\frac{m_i}{m_{i,0}}<1$. If these samples are used as initial material in a second litterbag experiment, this allows to estimate decomposition rates when $\frac{m_i}{m_{i,0}} \neq 1$ and thus to estimate $\alpha$ more accurately than from litterbag experiments of previously undecomposed litter.  
The two stages ensure that $m_i$ can be measured instead of just estimated from several replicates where we know that the variation in remaining masses is large even under controlled conditions [@Bengtsson.2017] which reduces uncertainties in $\frac{m_i}{m_{i,0}}$ as much as possible.  
Initial leaching losses should be accurately quantified to also get precise estimates for decomposition rates. If the HPM is correct, this experiment should give an estimate for $\alpha$ near 2.




# [---todo: Put the following somwhere into the discussion]

- I can replicate the analysis from @Bengtsson.2017 by plotting estimated decomposition rates against the niche water table depth, for the model considering or ignoring initial leaching losses.
- I have seen there that the patterns in decomposition rates and leaching losses are similar between parameters estimated for replicates from @Bengtsson.2017 and parameters estimated for replicates of all other studies. This may indicate (if it is not just a pooling artifact from the hierarchical model) that litter chemistry is the dominant control of decomposition rates, as suggested by some authors. In addition, my results provide updated and synthesized estimates for this gradient in decomposition rates.

Our reanalysis of past data while considering leaching losses sheds new light on old hypotheses, either by providing a synthesis of available data or by providing estimates which account for leaching losses:
1. Litter chemistry is the main control of *Sphagnum* decomposition rates [@Turetsky.2008].
2. The decomposition rate of *Sphagnum* species declines across the gradient from hollows to hummocks [@Bengtsson.2017].



# Limitations

We ignore the possibility that there may be organic matter fractions in the samples which are not decomposed under the given conditions, e.g., by using a two- or more-pool exponential decomposition model. As a consequence, one may criticize that our model may estimate decomposition of a first (or first and second) labile pool as initial leaching loss and thus, initial leaching losses are overestimated (because they also describe decomposition as depolymerization of a labile pool) and decomposition rates (of the entire polymeric fraction) underestimated. While we cannot exclude the possibility that under some experimental conditions, part of the *Sphagnum* samples do not decompose or decompose at a slower rate than other parts, gross false estimates are unlikely for several reasons: First, we have given in the introduction strong arguments in favor of leaching losses in at least the range [0 to 18] mass-% and many of our estimates are in this range. Second, high decomposition rates are estimated by our model if after the first sampling additional mass losses occur. [---todo: continue here]    

can be considered to represent a two-pool exponential decomposition model where decomposition of the first pool is represented by a constant mass loss and the second pool decomposes with exponential rate. 



```{r}
# idea for a simpler model to use in the PDPM for decomposition. Use a three-pool model like:
curve((exp(-2 * x) + exp(-0.1 * x) + exp(-0.02 * x))/2, from = 0, to = 100)
# where the first pool are leaching losses, the second are decomposition losses as estimated from litterbag data, the third are decomposition losses from older peat and Sphagnum smaples which have not experienced leaching. [---todo: This latter assumption still needs checking]
```

-->






# Conclusions

Estimating HPM parameters from *Sphagnum* litterbag experiments suggests larger anaerobic decomposition rates and a less steep gradient of decomposition rates from oxic to anoxic conditions than implied by the HPM with standard parameter values. With these modifications, the HPM fits available litterbag data within the range of uncertainties. However, due to large uncertainties in available litterbag data, particularly about how much of the mass is lost due to initial leaching and how much due to decomposition, the HPM with standard values can achieve comparable fits if mass loss in litterbag experiments is explained by larger initial leaching and slower subsequent decomposition. Therefore, stronger tests of the HPM require more accurate estimates for initial leaching losses and decomposition rates.

The larger anaerobic decomposition rates and less steep gradient of decomposition rates from oxic to anoxic conditions compared to the HPM with standard parameter values is a consequence of larger estimates for the anoxia scale length ($c_2$) and the optimium degree of saturation for decomposition ($W_{opt}$). This discrepancy may be caused by neglecting an increase of decomposition rates below the annual average water table depth due to water table fluctuations, differences in groundwater flow, or spatial averaging in litterbag experiments. Our estimates may be an easy way to account for such effects in the HPM if effects of these fluctuations on decomposition rates can be averaged over time as implied by the suggested parameter estimates.  

Less limitation of anaerobic decomposition rates than suggested by the HPM would imply differences in predicted C accumulation rates of up to 100 kg$_\text{C}$ m$^{-2}$ over 5000 years (with a maximum total C accumulation of ca. 430 kg$_\text{C}$ m$^{-2}$), according to previous sensitivity analyses. Future litterbag experiments should improve the accuracy of initial leaching loss and decomposition rate estimates and then test whether the identified parameter discrepancies are reproducible and whether they can be described by known, but not yet fully quantified, controls of decomposition rates in dependency of water table fluctuations.  

<!--

Our results suggest that decomposition rates predicted by the HPM agree with decomposition rates estimated from litterbag data within the range of uncertainty if we assume comparatively large initial leaching losses

The main question we wanted to answer was whether the HPM can predict litterbag decomposition rates for different *Sphagnum* species along the gradient from oxic to anoxic conditions. Our analysis suggests that this is in principle possible, but only if we assume larger initial leaching losses and smaller decomposition rates than our previous estimates for the same litterbag data [@Teickner.2024] and it is questionable whether such high initial leaching losses are realistic. Since decomposition rate estimates are sensitive to initial leaching losses, an important result of our analysis is that accurate estimates of initial leaching losses should improve our test of the HPM decomposition module.

Despite these uncertainties, the models suggest that the anoxia scale length ($c_2$) and the optimium degree of saturation for decomposition ($W_{opt}$) are larger than suggested by the standard HPM and that both discrepancies imply a less steep gradient of decomposition rates from oxic to anoxic conditions and less limitation of anaerobic decomposition rates than suggested by the HPM. If true, this would imply differences in predicted C accumulation rates of up to 100 kg$_\text{C}$ m$^{-2}$ over 5000 years according to previous sensitivity analyses of the HPM. 

We suggest that the less steep gradient of decomposition rates from oxic to anoxic conditions may be caused by not considering water table fluctuations, which would temporarily shift aeration, regenerate depleted electron acceptors, release accumulated mineralization end products, etc, in the HPM and our evaluation of litterbag experiments. Our estimates may be an easy way to account for such effects in the HPM if effects of these fluctuations on decomposition rates can be averaged over time as implied by the suggested parameter estimates. 
-->

<!--Finally, our model suggest that it may be possible to more accurately estimate the rate at which decomposition rates decrease with increasing mass loss during decomposition ($\alpha$) for species with large decomposition rate, but that other approaches than litterbag experiments of fresh litter would be necessary in other cases and for more detailed analyses.--> 


<!--# Todo

3. Sensitivity analysis showing how hpm_k_2 is sensitive to initial leaching losses. Sensitivity analysis showing how decomposition rate estimates are sensitive to initial leaching losses.
4. Test how estimated $k_0$ (model 3-3) relate to litter chemistry. [---done]
5. Can we explain differences in initial leaching losses between studies for the same species (and under the same conditions, at least moisture) by differences in drying procedures?
6. Repeat analysis without samples which are not compatible with the data model (the one-pool exponential decomposition model). [---done]
7. Perform a cross validation (blocked according to study) to estimate the predictive accuracy of the different HPM versions. [---done]
8. Check whether predictions with the HPM differ if one accounts for the dependence of the decomposition rate of the remaining mass. [---done]
-->

<!--
[---todo: Fig. 5: Make parameter names italics]
[---todo: to add: Treat.2021 actually estimated c2 for several permafrost peatlands and this optimization procuded c2 compatible with the standard value for some peatlands, but c2 considerably larger for other peatlands. I should mention this since this is also partly support of my findings. I should also mention this study in the introduction as model test. Something to consider here is that @Treat.2021 use a modification of the HPM where they model WTD and decomposition on monthly time steps, thus the model does account for some seasonal WTD fluctuations already and still sometimes estimates larger c2. This would be puzzling even with our findings because we suggest that the larger c2 may be caused by neglecting seasonal WTD fluctuations.]
-->

# Acknowledgements {.unnumbered}

This study was funded by the Deutsche Forschungsgemeinschaft (DFG, German Research Foundation) grant no. KN 929/23-1 to Klaus-Holger Knorr and grant no. PE 1632/18-1 to Edzer Pebesma.

# Author contributions {.unnumbered}

HT: Conceptualization, methodology, software, validation, formal analysis, investigation, data curation, writing, visualization, project administration. EP: supervision, funding acquisition, writing - review & editing. KHK: supervision, funding acquisition, writing - review & editing.

# Data and code availability {.unnumbered}

Data and code to reproduce this manuscript are available from ... [---todo:ref] 


# References {.unnumbered}


---
abstract: |
  Testing peatland models is necessary to improve understanding and predictions of future peatland carbon dynamics. The Holocene Peatland Model (HPM) is widely applied, but currently insufficiently tested. Here, we test the decomposition module of the HPM by comparing predicted decomposition rates against decomposition rates estimated from available *Sphagnum* litterbag data along a gradient from oxic to anoxic conditions.<!-- We also test whether the slow-down of decomposition rates during progressing decomposition ($\alpha$) may be estimated more reliably with litterbag experiments specifically designed for this purporse.-->  
  Our analysis indicates that the HPM may underestimate anaerobic decomposition rates and assumes a too steep decrease of decomposition rates from oxic to anoxic conditions. This may be caused by not considering effects of water table fluctuations on aerobic and anaerobic decomposition rates.  
  Large uncertainties in available litterbag data allow predictions of the HPM with standard parameter values to fit decomposition rates estimated from litterbags by adjusting initial leaching losses and decomposition rates estimated from the litterbag data within the range of their uncertainties. Therefore, improved tests of the HPM rely on future litterbag experiments that allow a more accurate estimation of initial leaching losses and decomposition rates.
  <!--Our analysis suggests that the HPM can in principle fit available litterbag data, but only if we assume larger initial leaching losses and smaller decomposition rates than existing previous estimates for the same litterbag data and it is currently unknown whether such large initial leaching losses are realistic. When HPM parameters are estimated from litterbag data, such large initial leaching loss estimates can be avoided. With these modifications, the anoxia scale length ($c_2$) and the optimium degree of saturation for decomposition ($W_{opt}$) are larger than suggested by the standard HPM. This implies a less steep gradient of decomposition rates from oxic to anoxic conditions and less limitation of anaerobic decomposition rates. We suggest that the less steep gradient of decomposition rates from oxic to anoxic conditions may be caused by not considering effects of water table fluctuations on aerobic and anaerobic decomposition rates.--><!-- Our models suggest that $\alpha$ may be estimated more accurately than in previous studies with fresh litter for *Sphagnum* species with large decomposition rates, but not for species with slower decomposition rates.-->  
  Based on previous sensitivity analyses of the HPM, our results have important implications for predicted long-term C accumulation. Whether the estimated parameter values may be an easy fix to account for effects of water table fluctuations in long-term predictions needs further investigation.
---
